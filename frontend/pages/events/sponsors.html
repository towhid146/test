<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Browse Sponsors - SponzoBD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <style>
      body {
        font-family: "Poppins", sans-serif;
      }
    </style>
  </head>
  <body
    class="min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-orange-50"
  >
    <div id="navbar"></div>

    <main class="pt-24 pb-16 px-4">
      <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="mb-12">
          <h1 class="text-4xl font-bold text-gray-900 mb-3">
            Discover Sponsors
          </h1>
          <p class="text-gray-600 text-lg">
            Find funding partners and support for your events and projects
          </p>
        </div>

        <!-- Filters -->
        <div
          class="bg-white/90 backdrop-blur-lg border border-purple-100 rounded-xl shadow-lg p-6 mb-8"
        >
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">
                <i class="fas fa-map-marker-alt mr-2 text-purple-600"></i
                >Location
              </label>
              <select
                id="location-filter"
                onchange="applyFilters()"
                class="w-full p-2.5 border border-purple-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
              >
                <option value="all">All Locations</option>
                <option value="dhaka">Dhaka</option>
                <option value="chittagong">Chittagong</option>
                <option value="sylhet">Sylhet</option>
                <option value="rajshahi">Rajshahi</option>
                <option value="gazipur">Gazipur</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">
                <i class="fas fa-bullseye mr-2 text-purple-600"></i>Focus Area
              </label>
              <select
                id="focusarea-filter"
                onchange="applyFilters()"
                class="w-full p-2.5 border border-purple-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
              >
                <option value="all">All Focus Areas</option>
                <option value="education">Education</option>
                <option value="healthcare">Healthcare</option>
                <option value="environment">Environment</option>
                <option value="technology">Technology</option>
                <option value="community">Community</option>
                <option value="sports">Sports</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">
                <i class="fas fa-money-bill-wave mr-2 text-purple-600"></i
                >Budget Range (৳)
              </label>
              <select
                id="budget-filter"
                onchange="applyFilters()"
                class="w-full p-2.5 border border-purple-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
              >
                <option value="all">All Budgets</option>
                <option value="0-10000">৳0 - ৳10,000</option>
                <option value="10000-50000">৳10,000 - ৳50,000</option>
                <option value="50000-100000">৳50,000 - ৳100,000</option>
                <option value="100000+">৳100,000+</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">
                <i class="fas fa-sort mr-2 text-purple-600"></i>Sort By
              </label>
              <select
                id="sort-by"
                onchange="applyFilters()"
                class="w-full p-2.5 border border-purple-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
              >
                <option value="newest">Newest First</option>
                <option value="budget-high">Budget: High to Low</option>
                <option value="budget-low">Budget: Low to High</option>
                <option value="name">Name: A to Z</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Loading State -->
        <div id="loading" class="text-center py-16">
          <div class="inline-flex flex-col items-center">
            <i class="fas fa-spinner fa-spin text-4xl text-purple-600 mb-4"></i>
            <p class="text-gray-600 text-lg">Loading sponsors...</p>
          </div>
        </div>

        <!-- Sponsors Grid -->
        <div
          id="sponsors-grid"
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
        >
          <!-- Sponsor cards will be inserted here -->
        </div>

        <!-- No Results -->
        <div id="no-results" class="hidden text-center py-16">
          <i class="fas fa-search text-5xl text-gray-300 mb-4 block"></i>
          <p class="text-gray-500 text-lg">
            No sponsors found matching your criteria.
          </p>
        </div>
      </div>
    </main>

    <script>
      const API_BASE = "https://test-6aiv.onrender.com/api";
      let allSponsors = [];

      function createSponsorCard(sponsor) {
        const logo =
          sponsor.logo ||
          `https://ui-avatars.com/api/?name=${encodeURIComponent(
            sponsor.companyName
          )}&background=6d28d9&color=fff&bold=true&size=200`;

        return `
          <div class="bg-white/90 backdrop-blur-lg border border-purple-100 rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 overflow-hidden group">
            <div class="relative h-40 bg-gradient-to-br from-purple-100 to-pink-100 overflow-hidden">
              <img src="${logo}" alt="${
          sponsor.companyName
        }" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-300" onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(
          sponsor.companyName
        )}&background=6d28d9&color=fff&bold=true&size=200'"/>
            </div>
            <div class="p-6">
              <h3 class="text-xl font-semibold text-gray-900 mb-2 truncate">${
                sponsor.companyName
              }</h3>
              <p class="text-sm text-purple-600 font-medium mb-4">${
                sponsor.industry || "N/A"
              }</p>
              
              <div class="space-y-3 mb-4 text-sm text-gray-600">
                <div class="flex items-center gap-2">
                  <i class="fas fa-map-marker-alt text-purple-600 w-4"></i>
                  <span>${sponsor.location || "N/A"}</span>
                </div>
                <div class="flex items-center gap-2">
                  <i class="fas fa-envelope text-purple-600 w-4"></i>
                  <span class="truncate">${sponsor.email || "N/A"}</span>
                </div>
                <div class="flex items-center gap-2">
                  <i class="fas fa-phone text-purple-600 w-4"></i>
                  <span>${sponsor.phone || "N/A"}</span>
                </div>
              </div>

              <div class="border-t border-purple-100 pt-4 mb-4">
                <p class="text-xs text-gray-500 mb-1">Budget</p>
                <p class="text-lg font-semibold text-purple-700">৳${(
                  sponsor.budget || 0
                ).toLocaleString()}</p>
              </div>

              ${
                sponsor.focusAreas && sponsor.focusAreas.length
                  ? `<div class="mb-4">
                      <p class="text-xs text-gray-500 mb-2">Focus Areas</p>
                      <div class="flex flex-wrap gap-2">
                        ${sponsor.focusAreas
                          .slice(0, 3)
                          .map(
                            (area) =>
                              `<span class="inline-block px-2 py-1 bg-purple-100 text-purple-700 text-xs rounded-full">${area}</span>`
                          )
                          .join("")}
                      </div>
                    </div>`
                  : ""
              }

              ${
                sponsor.description
                  ? `<p class="text-sm text-gray-600 mb-4 line-clamp-2">${sponsor.description}</p>`
                  : ""
              }

              <div class="flex gap-3">
                <a href="mailto:${
                  sponsor.email
                }" class="flex-1 px-4 py-2 rounded-lg bg-purple-600 text-white text-center hover:bg-purple-700 transition font-medium text-sm">
                  <i class="fas fa-envelope mr-2"></i>Contact
                </a>
                <a href="../profiles/sponsor-profile.html?id=${
                  sponsor._id
                }" class="flex-1 px-4 py-2 rounded-lg border border-purple-200 text-purple-700 text-center hover:bg-purple-50 transition font-medium text-sm">
                  <i class="fas fa-eye mr-2"></i>View
                </a>
              </div>
            </div>
          </div>
        `;
      }

      async function loadSponsors() {
        try {
          const response = await fetch(`${API_BASE}/auth/sponsors`);
          if (!response.ok) throw new Error(`Server error ${response.status}`);

          const data = await response.json();
          allSponsors = data.data || data;

          if (!allSponsors || allSponsors.length === 0) {
            document.getElementById("loading").classList.add("hidden");
            document.getElementById("no-results").classList.remove("hidden");
            return;
          }

          applyFilters();
          document.getElementById("loading").classList.add("hidden");
        } catch (error) {
          console.error("Error loading sponsors:", error);
          document.getElementById("loading").innerHTML = `
            <div class="max-w-md mx-auto bg-red-50 border border-red-200 rounded-xl p-8 text-center">
              <i class="fas fa-exclamation-circle text-4xl text-red-600 mb-4 block"></i>
              <p class="text-red-700 font-semibold mb-2">Failed to Load Sponsors</p>
              <p class="text-gray-600 text-sm mb-4">${error.message}</p>
              <button onclick="location.reload()" class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition font-medium">
                <i class="fas fa-redo mr-2"></i>Retry
              </button>
            </div>
          `;
        }
      }

      function applyFilters() {
        let filtered = [...allSponsors];

        const locationFilter =
          document.getElementById("location-filter")?.value || "all";
        const focusAreaFilter =
          document.getElementById("focusarea-filter")?.value || "all";
        const budgetFilter =
          document.getElementById("budget-filter")?.value || "all";
        const sortBy = document.getElementById("sort-by")?.value || "newest";

        // Apply filters
        if (locationFilter !== "all") {
          filtered = filtered.filter(
            (sponsor) =>
              sponsor.location?.toLowerCase() === locationFilter.toLowerCase()
          );
        }

        if (focusAreaFilter !== "all") {
          filtered = filtered.filter((sponsor) => {
            if (!sponsor.focusAreas) return false;
            const focusAreas = Array.isArray(sponsor.focusAreas)
              ? sponsor.focusAreas
              : [sponsor.focusAreas];
            return focusAreas.some(
              (area) => area.toLowerCase() === focusAreaFilter.toLowerCase()
            );
          });
        }

        if (budgetFilter !== "all") {
          const budgetRanges = {
            "0-10000": [0, 10000],
            "10000-50000": [10000, 50000],
            "50000-100000": [50000, 100000],
            "100000+": [100000, Infinity],
          };

          const [min, max] = budgetRanges[budgetFilter] || [0, Infinity];
          filtered = filtered.filter((sponsor) => {
            const budget = sponsor.budget || 0;
            return budget >= min && budget <= max;
          });
        }

        // Apply sorting
        switch (sortBy) {
          case "budget-high":
            filtered.sort((a, b) => (b.budget || 0) - (a.budget || 0));
            break;
          case "budget-low":
            filtered.sort((a, b) => (a.budget || 0) - (b.budget || 0));
            break;
          case "name":
            filtered.sort((a, b) =>
              (a.companyName || "").localeCompare(b.companyName || "")
            );
            break;
          case "newest":
          default:
            filtered.sort(
              (a, b) => new Date(b.createdAt) - new Date(a.createdAt)
            );
        }

        // Display results
        const grid = document.getElementById("sponsors-grid");
        const noResults = document.getElementById("no-results");

        if (filtered.length === 0) {
          grid.classList.add("hidden");
          noResults.classList.remove("hidden");
        } else {
          grid.innerHTML = filtered
            .map((sponsor) => createSponsorCard(sponsor))
            .join("");
          grid.classList.remove("hidden");
          noResults.classList.add("hidden");
        }
      }

      window.addEventListener("DOMContentLoaded", loadSponsors);
    </script>

    <script src="../../components/navbar.js"></script>
  </body>
</html>
