<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sponsor Profile - SponzoBD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Space+Grotesk:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Inter", sans-serif;
        overflow-x: hidden;
      }
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #1a1a2e;
      }
      ::-webkit-scrollbar-thumb {
        background: linear-gradient(180deg, #7c3aed, #a855f7);
        border-radius: 10px;
      }
      .page-bg {
        background: linear-gradient(-45deg, #0f0c29, #302b63, #24243e, #1a1a2e);
        background-size: 400% 400%;
        animation: gradientShift 15s ease infinite;
        min-height: 100vh;
      }
      @keyframes gradientShift {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }
      .particles {
        position: fixed;
        width: 100%;
        height: 100%;
        overflow: hidden;
        top: 0;
        left: 0;
        pointer-events: none;
        z-index: 0;
      }
      .particle {
        position: absolute;
        width: 6px;
        height: 6px;
        background: rgba(124, 58, 237, 0.4);
        border-radius: 50%;
        animation: floatParticle 20s infinite;
      }
      .particle:nth-child(1) {
        left: 10%;
        animation-delay: 0s;
      }
      .particle:nth-child(2) {
        left: 30%;
        animation-delay: 2s;
      }
      .particle:nth-child(3) {
        left: 50%;
        animation-delay: 4s;
      }
      .particle:nth-child(4) {
        left: 70%;
        animation-delay: 1s;
      }
      .particle:nth-child(5) {
        left: 90%;
        animation-delay: 3s;
      }
      @keyframes floatParticle {
        0% {
          transform: translateY(100vh) scale(0);
          opacity: 0;
        }
        10% {
          opacity: 1;
        }
        90% {
          opacity: 1;
        }
        100% {
          transform: translateY(-100vh) scale(1);
          opacity: 0;
        }
      }
      .glass-card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        transition: all 0.4s ease;
      }
      .glass-card:hover {
        border-color: rgba(124, 58, 237, 0.3);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      }
      .gradient-text {
        background: linear-gradient(
          135deg,
          #7c3aed 0%,
          #a855f7 50%,
          #ec4899 100%
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      .orb {
        position: fixed;
        border-radius: 50%;
        filter: blur(80px);
        opacity: 0.3;
        animation: orbFloat 8s ease-in-out infinite;
        pointer-events: none;
        z-index: 0;
      }
      .orb-1 {
        width: 350px;
        height: 350px;
        background: linear-gradient(135deg, #7c3aed, #a855f7);
        top: -100px;
        right: -100px;
      }
      .orb-2 {
        width: 280px;
        height: 280px;
        background: linear-gradient(135deg, #ec4899, #f97316);
        bottom: -80px;
        left: -80px;
        animation-delay: 2s;
      }
      @keyframes orbFloat {
        0%,
        100% {
          transform: translate(0, 0) scale(1);
        }
        50% {
          transform: translate(30px, 30px) scale(1.1);
        }
      }
      .profile-section {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 16px;
        padding: 1.5rem;
      }
      .modal-overlay {
        display: none;
        position: fixed;
        z-index: 2000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(5px);
        overflow: auto;
        justify-content: center;
        align-items: center;
      }
      .modal-content {
        background: linear-gradient(145deg, #1a1a2e, #16162a);
        border: 1px solid rgba(255, 255, 255, 0.1);
        padding: 30px;
        border-radius: 20px;
        width: 90%;
        max-width: 500px;
        position: relative;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
      }
      .modal-input {
        width: 100%;
        padding: 12px 16px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        color: white;
        font-size: 0.95rem;
        transition: all 0.3s ease;
      }
      .modal-input:focus {
        outline: none;
        border-color: rgba(124, 58, 237, 0.5);
        box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
      }
      .modal-input::placeholder {
        color: rgba(255, 255, 255, 0.4);
      }
      .modal-label {
        display: block;
        font-size: 0.875rem;
        font-weight: 500;
        color: #d1d5db;
        margin-bottom: 0.5rem;
      }
      .btn-gradient {
        background: linear-gradient(135deg, #7c3aed, #a855f7);
        color: white;
        padding: 12px 24px;
        border-radius: 12px;
        font-weight: 600;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 100%;
      }
      .btn-gradient:hover {
        box-shadow: 0 10px 20px rgba(124, 58, 237, 0.3);
        transform: translateY(-2px);
      }
    </style>
  </head>
  <body class="page-bg">
    <div class="particles">
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
    </div>
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>

    <div id="navbar"></div>

    <!-- Main Content -->
    <main
      class="relative z-10 max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-28"
    >
      <!-- Profile Header -->
      <div class="glass-card overflow-hidden mb-6" data-aos="fade-up">
        <div
          class="relative h-48 bg-gradient-to-br from-purple-900/50 to-pink-900/50"
        >
          <img
            id="coverPhoto"
            src="https://images.unsplash.com/photo-1497366216548-37526070297c?auto=format&fit=crop&w=1200&h=400&q=80"
            alt="Cover Image"
            class="w-full h-full object-cover opacity-80"
          />
          <button
            type="button"
            onclick="openImageUploadModal('cover')"
            class="absolute bottom-4 right-4 bg-white/10 backdrop-blur-md p-2 rounded-full border border-white/20 hover:bg-white/20 transition"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5 text-white"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"
              />
            </svg>
          </button>
        </div>
        <div class="relative px-6 py-4">
          <div class="absolute -top-16 left-6">
            <div class="relative group">
              <img
                id="profilePicture"
                src="https://images.unsplash.com/photo-1560179707-f14e90ef3623?auto=format&fit=crop&w=128&h=128&q=80"
                alt="Company Logo"
                class="w-32 h-32 rounded-xl border-4 border-[#1a1a2e] shadow-xl bg-[#1a1a2e] object-cover"
              />
              <button
                type="button"
                onclick="openImageUploadModal('profile')"
                class="absolute inset-0 flex items-center justify-center bg-black/60 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity"
              >
                <i class="fas fa-camera text-white text-2xl"></i>
              </button>
            </div>
          </div>
          <div class="mt-16 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div>
              <h1
                id="companyName"
                class="text-2xl font-bold text-white font-space"
              >
                Loading...
              </h1>
              <p id="industry" class="text-purple-400">Loading...</p>
            </div>
            <!-- Profile Progress -->
            <div id="profileProgress" class="bg-white/5 rounded-xl p-4 min-w-[200px]">
              <div class="flex items-center justify-between mb-2">
                <span class="text-sm text-gray-400">Profile Completion</span>
                <span id="progressPercent" class="text-sm font-semibold text-purple-400">0%</span>
              </div>
              <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                <div id="progressBar" class="h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full transition-all duration-500" style="width: 0%"></div>
              </div>
              <p id="progressTip" class="text-xs text-gray-500 mt-2 hidden"></p>
            </div>
          </div>
        </div>
      </div>

      <!-- Profile Content -->
      <div id="profile-container" class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Left Column -->
        <div class="md:col-span-1 space-y-6">
          <!-- Contact Information -->
          <div class="profile-section" data-aos="fade-up" data-aos-delay="100">
            <div class="flex justify-between items-center mb-4">
              <h2 class="text-lg font-semibold text-white">
                Contact Information
              </h2>
              <button
                type="button"
                onclick="openEditModal('contact')"
                class="text-purple-400 hover:text-purple-300 transition"
              >
                <i class="fas fa-edit"></i>
              </button>
            </div>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-500"
                  >Email</label
                >
                <p id="email" class="mt-1 text-gray-200">Loading...</p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-500"
                  >Phone</label
                >
                <p id="phone" class="mt-1 text-gray-200">Loading...</p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-500"
                  >Contact Person</label
                >
                <p id="contactPerson" class="mt-1 text-gray-200">Loading...</p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-500"
                  >Location</label
                >
                <p id="location" class="mt-1 text-gray-200">Loading...</p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-500"
                  >Website</label
                >
                <p id="website" class="mt-1 text-purple-400">Loading...</p>
              </div>
            </div>
          </div>

          <!-- Professional Links -->
          <div class="profile-section" data-aos="fade-up" data-aos-delay="200">
            <div class="flex justify-between items-center mb-4">
              <h2 class="text-lg font-semibold text-white">
                Social & Professional Links
              </h2>
              <button
                type="button"
                onclick="openEditModal('social')"
                class="text-purple-400 hover:text-purple-300 transition"
              >
                <i class="fas fa-edit"></i>
              </button>
            </div>
            <div class="space-y-3">
              <a
                id="linkedinLink"
                href="#"
                class="flex items-center text-gray-400 hover:text-purple-400 transition"
                style="display: none;"
              >
                <i class="fab fa-linkedin text-xl w-6 mr-3"></i>
                <span>LinkedIn</span>
              </a>
              <a
                id="twitterLink"
                href="#"
                class="flex items-center text-gray-400 hover:text-blue-400 transition"
                style="display: none;"
              >
                <i class="fab fa-twitter text-xl w-6 mr-3"></i>
                <span>Twitter</span>
              </a>
              <a
                id="facebookLink"
                href="#"
                class="flex items-center text-gray-400 hover:text-blue-600 transition"
                style="display: none;"
              >
                <i class="fab fa-facebook text-xl w-6 mr-3"></i>
                <span>Facebook</span>
              </a>
              <a
                id="instagramLink"
                href="#"
                class="flex items-center text-gray-400 hover:text-pink-500 transition"
                style="display: none;"
              >
                <i class="fab fa-instagram text-xl w-6 mr-3"></i>
                <span>Instagram</span>
              </a>
              <a
                id="websiteLink"
                href="#"
                class="flex items-center text-gray-400 hover:text-green-400 transition"
                style="display: none;"
              >
                <i class="fas fa-globe text-xl w-6 mr-3"></i>
                <span>Website</span>
              </a>
              <p id="noSocialLinks" class="text-gray-500 text-sm">No social links added yet. Click edit to add your links.</p>
            </div>
          </div>
            </div>
          </div>
        </div>

        <!-- Right Column -->
        <div class="md:col-span-2 space-y-6">
          <!-- About -->
          <div class="profile-section" data-aos="fade-up" data-aos-delay="100">
            <div class="flex justify-between items-center mb-4">
              <h2 class="text-lg font-semibold text-white">About</h2>
              <button
                type="button"
                onclick="openEditModal('about')"
                class="text-purple-400 hover:text-purple-300 transition"
              >
                <i class="fas fa-edit"></i>
              </button>
            </div>
            <p id="description" class="text-gray-400">Loading...</p>
          </div>

          <!-- Sponsorship Preferences -->
          <div class="profile-section" data-aos="fade-up" data-aos-delay="200">
            <div class="flex justify-between items-center mb-4">
              <h2 class="text-lg font-semibold text-white">
                Sponsorship Preferences
              </h2>
              <button
                type="button"
                onclick="openEditModal('preferences')"
                class="text-purple-400 hover:text-purple-300 transition"
              >
                <i class="fas fa-edit"></i>
              </button>
            </div>
            <div class="space-y-4">
              <div>
                <h3 class="text-sm font-medium text-gray-500">Focus Areas</h3>
                <div id="focusAreasContainer" class="mt-2 flex flex-wrap gap-2">
                  <span
                    class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-purple-500/20 text-purple-300 border border-purple-500/30"
                    >Loading...</span
                  >
                </div>
              </div>
              <div>
                <h3 class="text-sm font-medium text-gray-500">Budget</h3>
                <p
                  id="budget"
                  class="mt-1 text-2xl font-bold gradient-text font-space"
                >
                  Loading...
                </p>
              </div>
            </div>
          </div>

          <!-- Sponsorship History -->
          <div class="profile-section" data-aos="fade-up" data-aos-delay="300">
            <h2 class="text-lg font-semibold text-white mb-4">
              Sponsorship History
            </h2>
            <div class="space-y-4">
              <div
                class="border-l-4 border-purple-500 pl-4 py-2 bg-white/5 rounded-r-lg"
              >
                <h3 class="font-medium text-white">Tech Summit 2024</h3>
                <p class="text-sm text-purple-400">Budget: ৳200,000</p>
                <p class="text-sm text-gray-500">March 15, 2024</p>
              </div>
              <div
                class="border-l-4 border-purple-500 pl-4 py-2 bg-white/5 rounded-r-lg"
              >
                <h3 class="font-medium text-white">Innovation Awards 2023</h3>
                <p class="text-sm text-purple-400">Budget: ৳150,000</p>
                <p class="text-sm text-gray-500">December 10, 2023</p>
              </div>
              <div
                class="border-l-4 border-purple-500 pl-4 py-2 bg-white/5 rounded-r-lg"
              >
                <h3 class="font-medium text-white">Startup Weekend</h3>
                <p class="text-sm text-purple-400">Budget: ৳100,000</p>
                <p class="text-sm text-gray-500">October 5, 2023</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Image Upload Modal -->
    <div id="imageUploadModal" class="modal-overlay">
      <div class="modal-content">
        <span
          class="close-btn absolute right-5 top-5 text-2xl font-bold cursor-pointer text-gray-400 hover:text-white transition"
          onclick="closeImageUploadModal()"
          >&times;</span
        >
        <h2
          id="imageModalTitle"
          class="text-xl font-bold text-white mb-6 font-space"
        >
          Update Image
        </h2>

        <div class="mb-4">
          <label class="modal-label">Choose Image</label>
          <input
            type="file"
            id="imageFileInput"
            accept="image/*"
            class="modal-input"
            style="padding: 10px"
          />
        </div>

        <div class="mb-4">
          <label class="modal-label">Or paste image URL</label>
          <input
            type="text"
            id="imageUrlInput"
            placeholder="https://example.com/image.jpg"
            class="modal-input"
          />
        </div>

        <div
          id="imagePreviewContainer"
          style="display: none"
          class="mb-4 text-center"
        >
          <img
            id="imagePreview"
            class="max-w-full max-h-48 rounded-lg border border-white/20 mx-auto"
          />
        </div>

        <button onclick="saveImage()" type="button" class="btn-gradient">
          Save Image
        </button>

        <div
          id="imageModalSuccess"
          style="display: none"
          class="mt-4 bg-green-500/20 border border-green-500/30 text-green-300 p-4 rounded-xl"
        >
          Image updated successfully!
        </div>
        <div
          id="imageModalError"
          style="display: none"
          class="mt-4 bg-red-500/20 border border-red-500/30 text-red-300 p-4 rounded-xl"
        >
          <span id="imageModalErrorMessage">Error updating image</span>
        </div>
      </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal-overlay">
      <div
        class="modal-content"
        style="max-width: 600px; max-height: 90vh; overflow-y: auto"
      >
        <span
          class="close-btn absolute right-5 top-5 text-2xl font-bold cursor-pointer text-gray-400 hover:text-white transition"
          onclick="closeEditModal()"
          >&times;</span
        >
        <h2
          id="modalTitle"
          class="text-xl font-bold text-white mb-6 font-space"
        >
          Edit Profile
        </h2>

        <form id="editForm">
          <!-- Contact Fields -->
          <div id="contactFields" style="display: none" class="space-y-4">
            <div>
              <label class="modal-label">Contact Person</label>
              <input type="text" id="editContactPerson" class="modal-input" />
            </div>
            <div>
              <label class="modal-label">Phone</label>
              <input type="tel" id="editPhone" class="modal-input" />
            </div>
            <div>
              <label class="modal-label">Location</label>
              <input type="text" id="editLocation" class="modal-input" />
            </div>
            <div>
              <label class="modal-label">Website</label>
              <input type="text" id="editWebsite" class="modal-input" />
            </div>
          </div>

          <!-- About Fields -->
          <div id="aboutFields" style="display: none" class="space-y-4">
            <div>
              <label class="modal-label">Company Name</label>
              <input type="text" id="editCompanyName" class="modal-input" />
            </div>
            <div>
              <label class="modal-label">Industry</label>
              <input type="text" id="editIndustry" class="modal-input" />
            </div>
            <div>
              <label class="modal-label">Description</label>
              <textarea
                id="editDescription"
                rows="5"
                class="modal-input"
              ></textarea>
            </div>
          </div>

          <!-- Preferences Fields -->
          <div id="preferencesFields" style="display: none" class="space-y-4">
            <div>
              <label class="modal-label">Focus Areas (comma-separated)</label>
              <input
                type="text"
                id="editFocusAreas"
                placeholder="e.g., Technology, Education"
                class="modal-input"
              />
            </div>
            <div>
              <label class="modal-label">Budget (BDT)</label>
              <input type="number" id="editBudget" class="modal-input" />
            </div>
          </div>

          <!-- Social Links Fields -->
          <div id="socialFields" style="display: none" class="space-y-4">
            <div>
              <label class="modal-label"><i class="fab fa-linkedin mr-2 text-blue-500"></i>LinkedIn URL</label>
              <input
                type="url"
                id="editLinkedin"
                placeholder="https://linkedin.com/company/..."
                class="modal-input"
              />
            </div>
            <div>
              <label class="modal-label"><i class="fab fa-twitter mr-2 text-blue-400"></i>Twitter URL</label>
              <input
                type="url"
                id="editTwitter"
                placeholder="https://twitter.com/..."
                class="modal-input"
              />
            </div>
            <div>
              <label class="modal-label"><i class="fab fa-facebook mr-2 text-blue-600"></i>Facebook URL</label>
              <input
                type="url"
                id="editFacebook"
                placeholder="https://facebook.com/..."
                class="modal-input"
              />
            </div>
            <div>
              <label class="modal-label"><i class="fab fa-instagram mr-2 text-pink-500"></i>Instagram URL</label>
              <input
                type="url"
                id="editInstagram"
                placeholder="https://instagram.com/..."
                class="modal-input"
              />
            </div>
          </div>

          <button type="submit" class="btn-gradient mt-6">Save Changes</button>
        </form>

        <div
          id="modalSuccess"
          style="display: none"
          class="mt-4 bg-green-500/20 border border-green-500/30 text-green-300 p-4 rounded-xl"
        >
          Profile updated successfully!
        </div>
        <div
          id="modalError"
          style="display: none"
          class="mt-4 bg-red-500/20 border border-red-500/30 text-red-300 p-4 rounded-xl"
        >
          <span id="modalErrorMessage">Error updating profile</span>
        </div>
      </div>
    </div>

    <script>
      const API_BASE = "https://test-6aiv.onrender.com/api";
      let currentSponsorData = {};
      let currentEditSection = null;
      let currentImageType = null;

      AOS.init({ duration: 800, easing: "ease-out-cubic", once: true });

      function openImageUploadModal(type) {
        currentImageType = type;
        document.getElementById("imageModalTitle").textContent =
          type === "profile" ? "Update Profile Picture" : "Update Cover Photo";
        document.getElementById("imageFileInput").value = "";
        document.getElementById("imageUrlInput").value = "";
        document.getElementById("imagePreviewContainer").style.display = "none";
        document.getElementById("imageModalSuccess").style.display = "none";
        document.getElementById("imageModalError").style.display = "none";
        document.getElementById("imageUploadModal").style.display = "flex";
      }

      function closeImageUploadModal() {
        document.getElementById("imageUploadModal").style.display = "none";
        currentImageType = null;
      }

      function compressImage(file, callback) {
        const reader = new FileReader();
        reader.onload = function (e) {
          const img = new Image();
          img.onload = function () {
            const canvas = document.createElement("canvas");
            const ctx = canvas.getContext("2d");
            const maxWidth = currentImageType === "cover" ? 1200 : 400;
            const maxHeight = currentImageType === "cover" ? 400 : 400;
            let width = img.width,
              height = img.height;
            if (width > height) {
              if (width > maxWidth) {
                height = height * (maxWidth / width);
                width = maxWidth;
              }
            } else {
              if (height > maxHeight) {
                width = width * (maxHeight / height);
                height = maxHeight;
              }
            }
            canvas.width = width;
            canvas.height = height;
            ctx.drawImage(img, 0, 0, width, height);
            callback(canvas.toDataURL("image/jpeg", 0.7));
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }

      async function saveImage() {
        const userId = localStorage.getItem("userId");
        const fileInput = document.getElementById("imageFileInput");
        const urlInput = document.getElementById("imageUrlInput");
        let imageUrl = urlInput.value.trim();
        if (fileInput.files && fileInput.files[0]) {
          const file = fileInput.files[0];
          if (file.size > 5 * 1024 * 1024) {
            document.getElementById("imageModalError").style.display = "block";
            document.getElementById("imageModalErrorMessage").textContent =
              "File size must be less than 5MB";
            return;
          }
          compressImage(file, async function (compressedBase64) {
            await updateImageOnServer(userId, compressedBase64);
          });
        } else if (imageUrl) {
          await updateImageOnServer(userId, imageUrl);
        } else {
          document.getElementById("imageModalError").style.display = "block";
          document.getElementById("imageModalErrorMessage").textContent =
            "Please select a file or enter an image URL";
        }
      }

      async function updateImageOnServer(userId, imageUrl) {
        const payload =
          currentImageType === "profile"
            ? { logo: imageUrl }
            : { coverPhoto: imageUrl };
        try {
          const response = await fetch(`${API_BASE}/auth/sponsor/${userId}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });
          const data = await response.json();
          if (!response.ok)
            throw new Error(data.message || "Failed to update image");
          currentSponsorData = data.data;
          displayProfile();
          document.getElementById("imageModalSuccess").style.display = "block";
          document.getElementById("imageModalError").style.display = "none";
          setTimeout(() => closeImageUploadModal(), 2000);
        } catch (error) {
          document.getElementById("imageModalError").style.display = "block";
          document.getElementById("imageModalErrorMessage").textContent =
            error.message;
        }
      }

      let profileCompletion = null;

      async function loadSponsorProfile(userId) {
        try {
          if (!userId)
            throw new Error("No userId provided. Please log in first.");
          const response = await fetch(`${API_BASE}/auth/sponsor/${userId}`);
          if (!response.ok) {
            const errorData = await response.json().catch(() => ({}));
            throw new Error(
              `Failed to load profile: ${response.status} - ${
                errorData.message || "Unknown error"
              }`
            );
          }
          const data = await response.json();
          if (!data.success || !data.data)
            throw new Error("Invalid response format from server");
          currentSponsorData = data.data;
          profileCompletion = data.profileCompletion;
          displayProfile();
        } catch (error) {
          console.error("Error loading profile:", error);
          const profileContainer = document.getElementById("profile-container");
          if (profileContainer) {
            profileContainer.innerHTML = `<div class="col-span-3 text-center py-12"><div class="glass-card p-8 max-w-md mx-auto"><i class="fas fa-exclamation-circle text-4xl text-red-400 mb-4 block"></i><p class="text-white font-semibold mb-2">Unable to Load Profile</p><p class="text-gray-400 mb-4">${error.message}</p><button onclick="location.reload()" class="btn-gradient"><i class="fas fa-redo mr-2"></i>Retry</button></div></div>`;
          }
        }
      }

      function displayProfile() {
        const data = currentSponsorData;
        const safeSet = (id, value) => {
          const el = document.getElementById(id);
          if (el) el.textContent = value;
        };
        safeSet("companyName", data.companyName || "N/A");
        safeSet("industry", data.industry || "N/A");
        safeSet("description", data.description || "No description provided");
        safeSet("email", data.email || "N/A");
        safeSet("phone", data.phone || "N/A");
        safeSet("contactPerson", data.contactPerson || "N/A");
        safeSet("location", data.location || "N/A");
        safeSet("website", data.website || "N/A");
        safeSet("budget", `৳${(data.budget || 0).toLocaleString()}`);
        const focusContainer = document.getElementById("focusAreasContainer");
        if (focusContainer) {
          focusContainer.innerHTML =
            (data.focusAreas || [])
              .map(
                (f) =>
                  `<span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-purple-500/20 text-purple-300 border border-purple-500/30">${f}</span>`
              )
              .join("") || '<span class="text-gray-500">N/A</span>';
        }
        const profilePicture = document.getElementById("profilePicture");
        if (profilePicture && data.logo) profilePicture.src = data.logo;
        const coverPhoto = document.getElementById("coverPhoto");
        if (coverPhoto && data.coverPhoto) coverPhoto.src = data.coverPhoto;
        
        // Update social links
        const socialLinks = data.socialLinks || {};
        let hasSocialLinks = false;
        
        const linkedinLink = document.getElementById("linkedinLink");
        if (linkedinLink && socialLinks.linkedin) {
          linkedinLink.href = socialLinks.linkedin;
          linkedinLink.style.display = "flex";
          hasSocialLinks = true;
        }
        
        const twitterLink = document.getElementById("twitterLink");
        if (twitterLink && socialLinks.twitter) {
          twitterLink.href = socialLinks.twitter;
          twitterLink.style.display = "flex";
          hasSocialLinks = true;
        }
        
        const facebookLink = document.getElementById("facebookLink");
        if (facebookLink && socialLinks.facebook) {
          facebookLink.href = socialLinks.facebook;
          facebookLink.style.display = "flex";
          hasSocialLinks = true;
        }
        
        const instagramLink = document.getElementById("instagramLink");
        if (instagramLink && socialLinks.instagram) {
          instagramLink.href = socialLinks.instagram;
          instagramLink.style.display = "flex";
          hasSocialLinks = true;
        }
        
        const websiteLink = document.getElementById("websiteLink");
        if (websiteLink && data.website) {
          websiteLink.href = data.website;
          websiteLink.style.display = "flex";
          hasSocialLinks = true;
        }
        
        const noSocialLinks = document.getElementById("noSocialLinks");
        if (noSocialLinks) {
          noSocialLinks.style.display = hasSocialLinks ? "none" : "block";
        }
        
        // Update profile progress
        if (profileCompletion) {
          const progressBar = document.getElementById("progressBar");
          const progressPercent = document.getElementById("progressPercent");
          const progressTip = document.getElementById("progressTip");
          
          if (progressBar) progressBar.style.width = `${profileCompletion.percentage}%`;
          if (progressPercent) progressPercent.textContent = `${profileCompletion.percentage}%`;
          
          // Show tip for incomplete profiles
          if (profileCompletion.percentage < 100 && progressTip) {
            const fieldNames = {
              'companyName': 'Company Name',
              'contactPerson': 'Contact Person',
              'description': 'Description',
              'website': 'Website',
              'logo': 'Logo',
              'coverPhoto': 'Cover Photo',
              'socialLinks.linkedin': 'LinkedIn',
              'socialLinks.twitter': 'Twitter',
              'socialLinks.facebook': 'Facebook',
              'socialLinks.instagram': 'Instagram',
            };
            const missingField = profileCompletion.missingFields[0];
            const friendlyName = fieldNames[missingField] || missingField;
            progressTip.textContent = `💡 Add ${friendlyName} to improve your profile`;
            progressTip.classList.remove('hidden');
          }
        }
      }

      function openEditModal(section) {
        currentEditSection = section;
        document.getElementById("contactFields").style.display = "none";
        document.getElementById("aboutFields").style.display = "none";
        document.getElementById("preferencesFields").style.display = "none";
        document.getElementById("socialFields").style.display = "none";
        document.getElementById("modalSuccess").style.display = "none";
        document.getElementById("modalError").style.display = "none";
        if (section === "contact") {
          document.getElementById("modalTitle").textContent =
            "Edit Contact Information";
          document.getElementById("contactFields").style.display = "block";
          document.getElementById("editContactPerson").value =
            currentSponsorData.contactPerson || "";
          document.getElementById("editPhone").value =
            currentSponsorData.phone || "";
          document.getElementById("editLocation").value =
            currentSponsorData.location || "";
          document.getElementById("editWebsite").value =
            currentSponsorData.website || "";
        } else if (section === "about") {
          document.getElementById("modalTitle").textContent =
            "Edit About Information";
          document.getElementById("aboutFields").style.display = "block";
          document.getElementById("editCompanyName").value =
            currentSponsorData.companyName || "";
          document.getElementById("editIndustry").value =
            currentSponsorData.industry || "";
          document.getElementById("editDescription").value =
            currentSponsorData.description || "";
        } else if (section === "preferences") {
          document.getElementById("modalTitle").textContent =
            "Edit Preferences";
          document.getElementById("preferencesFields").style.display = "block";
          document.getElementById("editFocusAreas").value = (
            currentSponsorData.focusAreas || []
          ).join(", ");
          document.getElementById("editBudget").value =
            currentSponsorData.budget || "";
        } else if (section === "social") {
          document.getElementById("modalTitle").textContent =
            "Edit Social Links";
          document.getElementById("socialFields").style.display = "block";
          const socialLinks = currentSponsorData.socialLinks || {};
          document.getElementById("editLinkedin").value = socialLinks.linkedin || "";
          document.getElementById("editTwitter").value = socialLinks.twitter || "";
          document.getElementById("editFacebook").value = socialLinks.facebook || "";
          document.getElementById("editInstagram").value = socialLinks.instagram || "";
        }
        document.getElementById("editModal").style.display = "flex";
      }

      function closeEditModal() {
        document.getElementById("editModal").style.display = "none";
        currentEditSection = null;
      }

      async function submitEditForm() {
        const userId = localStorage.getItem("userId");
        let payload = {};
        if (currentEditSection === "contact") {
          payload = {
            contactPerson: document
              .getElementById("editContactPerson")
              .value.trim(),
            phone: document.getElementById("editPhone").value.trim(),
            location: document.getElementById("editLocation").value.trim(),
            website: document.getElementById("editWebsite").value.trim(),
          };
        } else if (currentEditSection === "about") {
          payload = {
            companyName: document
              .getElementById("editCompanyName")
              .value.trim(),
            industry: document.getElementById("editIndustry").value.trim(),
            description: document
              .getElementById("editDescription")
              .value.trim(),
          };
        } else if (currentEditSection === "preferences") {
          payload = {
            focusAreas: document
              .getElementById("editFocusAreas")
              .value.split(",")
              .map((x) => x.trim())
              .filter(Boolean),
            budget: parseInt(document.getElementById("editBudget").value, 10),
          };
        } else if (currentEditSection === "social") {
          payload = {
            socialLinks: {
              linkedin: document.getElementById("editLinkedin").value.trim(),
              twitter: document.getElementById("editTwitter").value.trim(),
              facebook: document.getElementById("editFacebook").value.trim(),
              instagram: document.getElementById("editInstagram").value.trim(),
            },
          };
        }
        try {
          const response = await fetch(`${API_BASE}/auth/sponsor/${userId}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });
          const data = await response.json();
          if (!response.ok)
            throw new Error(data.message || "Failed to update profile");
          currentSponsorData = data.data;
          profileCompletion = data.profileCompletion;
          displayProfile();
          document.getElementById("modalSuccess").style.display = "block";
          document.getElementById("modalError").style.display = "none";
          setTimeout(() => closeEditModal(), 2000);
        } catch (error) {
          document.getElementById("modalError").style.display = "block";
          document.getElementById("modalErrorMessage").textContent =
            error.message;
        }
      }

      window.onclick = function (event) {
        if (event.target === document.getElementById("editModal"))
          closeEditModal();
        if (event.target === document.getElementById("imageUploadModal"))
          closeImageUploadModal();
      };

      document.addEventListener("DOMContentLoaded", function () {
        const fileInput = document.getElementById("imageFileInput");
        const urlInput = document.getElementById("imageUrlInput");
        const previewContainer = document.getElementById(
          "imagePreviewContainer"
        );
        const previewImg = document.getElementById("imagePreview");
        if (fileInput) {
          fileInput.addEventListener("change", function (e) {
            if (e.target.files && e.target.files[0]) {
              const reader = new FileReader();
              reader.onload = function (event) {
                previewImg.src = event.target.result;
                previewContainer.style.display = "block";
              };
              reader.readAsDataURL(e.target.files[0]);
              urlInput.value = "";
            }
          });
        }
        if (urlInput) {
          urlInput.addEventListener("input", function (e) {
            const url = e.target.value.trim();
            if (url) {
              previewImg.src = url;
              previewContainer.style.display = "block";
              fileInput.value = "";
            } else {
              previewContainer.style.display = "none";
            }
          });
        }
        const urlId = new URLSearchParams(window.location.search).get("id");
        const loggedInId = localStorage.getItem("userId");
        const userRole = localStorage.getItem("userRole");
        const canEdit = urlId
          ? loggedInId && urlId === loggedInId
          : loggedInId && userRole === "sponsor";
        if (!canEdit) {
          document
            .querySelectorAll(
              'button[onclick^="openEditModal"], button[onclick^="openImageUploadModal"]'
            )
            .forEach((btn) => (btn.style.display = "none"));
        }
        let userId = urlId || loggedInId;
        if (!userId) {
          alert("Please log in first");
          window.location.href = "../../pages/auth/login.html";
          return;
        }
        loadSponsorProfile(userId);
        const editForm = document.getElementById("editForm");
        if (editForm) {
          editForm.addEventListener("submit", function (e) {
            e.preventDefault();
            submitEditForm();
          });
        }
      });
    </script>
    <script src="../../components/navbar.js"></script>
  </body>
</html>
