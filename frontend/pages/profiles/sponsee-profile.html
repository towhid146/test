<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sponsee Profile - SponzoBD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      /* Navigation Styles */
      .navbar {
        background: #ffffff;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        padding: 1rem 0;
        position: sticky;
        top: 0;
        z-index: 1000;
      }

      .nav-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .nav-logo {
        display: flex;
        align-items: center;
        text-decoration: none;
        background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-size: 1.5rem;
        font-weight: 700;
      }

      .nav-logo i {
        margin-right: 10px;
        font-size: 1.8rem;
      }

      .nav-links {
        display: flex;
        gap: 2rem;
        align-items: center;
      }

      .nav-link {
        text-decoration: none;
        color: #333;
        font-weight: 500;
        transition: color 0.3s ease;
        position: relative;
      }

      .nav-link:hover {
        background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .nav-link::after {
        content: "";
        position: absolute;
        width: 0;
        height: 2px;
        bottom: -5px;
        left: 0;
        background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
        transition: width 0.3s ease;
      }

      .nav-link:hover::after {
        width: 100%;
      }

      .nav-buttons {
        display: flex;
        gap: 1rem;
        align-items: center;
      }

      .nav-button {
        padding: 0.5rem 1.2rem;
        border-radius: 5px;
        font-weight: 500;
        text-decoration: none;
        transition: all 0.3s ease;
      }

      .nav-button.login {
        color: #8b5cf6;
        border: 2px solid #8b5cf6;
      }

      .nav-button.login:hover {
        background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
        color: white;
      }

      .nav-button.signup {
        background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
        color: white;
      }

      .nav-button.signup:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
      }

      .mobile-menu {
        display: none;
        font-size: 1.5rem;
        color: #333;
        cursor: pointer;
      }

      @media (max-width: 768px) {
        .nav-links {
          display: none;
        }

        .mobile-menu {
          display: block;
        }

        .nav-buttons {
          display: none;
        }
      }
    </style>
  </head>
  <body class="min-h-screen bg-gray-50">
    <!-- Navigation (Loaded Dynamically) -->

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- Profile Header -->
      <div class="bg-white rounded-lg shadow overflow-hidden mb-6">
        <div class="relative h-48 bg-blue-600">
          <img
            id="coverPhoto"
            src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&h=400&q=80"
            alt="Cover Image"
            class="w-full h-full object-cover"
          />
          <button
            onclick="openImageUploadModal('cover')"
            class="absolute bottom-4 right-4 bg-white p-2 rounded-full shadow hover:bg-gray-100"
            type="button"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-5 w-5 text-gray-600"
              viewBox="0 0 20 20"
              fill="currentColor"
            >
              <path
                d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"
              />
            </svg>
          </button>
        </div>
        <div class="relative px-6 py-4">
          <div class="absolute -top-16 left-6">
            <div class="relative group">
              <img
                id="profilePicture"
                src="https://images.unsplash.com/photo-1517841905240-472988babdf9?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=128&h=128&q=80"
                alt="Project Logo"
                class="w-32 h-32 rounded-lg border-4 border-white shadow-lg bg-white object-cover"
              />
              <button
                onclick="openImageUploadModal('profile')"
                class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity"
                type="button"
              >
                <i class="fas fa-camera text-white text-2xl"></i>
              </button>
            </div>
          </div>
          <div class="mt-16">
            <h1 id="eventName" class="text-2xl font-bold text-gray-900">
              Loading...
            </h1>
            <p id="organization" class="text-gray-600">Loading...</p>
          </div>
        </div>
      </div>

      <!-- Profile Content -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Left Column -->
        <div class="md:col-span-1 space-y-6">
          <!-- Contact Information -->
          <div class="bg-white rounded-lg shadow p-6">
            <div class="flex justify-between items-center mb-4">
              <h2 class="text-lg font-semibold text-gray-900">
                Contact Information
              </h2>
              <button
                onclick="openEditModal('contact')"
                class="text-purple-600 hover:text-purple-800"
              >
                <i class="fas fa-edit"></i>
              </button>
            </div>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Email</label
                >
                <p id="email" class="mt-1 text-gray-900">email@example.com</p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Phone</label
                >
                <p id="phone" class="mt-1 text-gray-900">+880 111 222 333</p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Contact Person</label
                >
                <p id="contactPerson" class="mt-1 text-gray-900">John Doe</p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700"
                  >Location</label
                >
                <p id="location" class="mt-1 text-gray-900">
                  Chittagong, Bangladesh
                </p>
              </div>
            </div>
          </div>

          <!-- Project Links -->
          <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">
              Project Links
            </h2>
            <div class="space-y-4">
              <a
                href="#"
                class="flex items-center text-purple-600 hover:text-purple-800"
              >
                <svg
                  class="h-5 w-5 mr-2"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"
                  />
                </svg>
                Project Website
              </a>
              <a
                href="#"
                class="flex items-center text-purple-600 hover:text-purple-800"
              >
                <svg
                  class="h-5 w-5 mr-2"
                  fill="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"
                  />
                </svg>
                Facebook Page
              </a>
            </div>
          </div>
        </div>

        <!-- Right Column -->
        <div class="md:col-span-2 space-y-6">
          <!-- About -->
          <div class="bg-white rounded-lg shadow p-6">
            <div class="flex justify-between items-center mb-4">
              <h2 class="text-lg font-semibold text-gray-900">About</h2>
              <button
                onclick="openEditModal('about')"
                class="text-purple-600 hover:text-purple-800"
              >
                <i class="fas fa-edit"></i>
              </button>
            </div>
            <p id="description" class="text-gray-600">
              EduRise Initiative is a non-profit project dedicated to providing
              quality education and digital skills to underprivileged youth in
              Bangladesh. Our mission is to bridge the digital divide and
              empower the next generation for a brighter future.
            </p>
          </div>

          <!-- Sponsorship Needs -->
          <div class="bg-white rounded-lg shadow p-6">
            <div class="flex justify-between items-center mb-4">
              <h2 class="text-lg font-semibold text-gray-900">Event Details</h2>
              <button
                onclick="openEditModal('event')"
                class="text-purple-600 hover:text-purple-800"
              >
                <i class="fas fa-edit"></i>
              </button>
            </div>
            <div class="space-y-4">
              <div>
                <h3 class="text-sm font-medium text-gray-700">
                  Expected Attendees
                </h3>
                <p id="expectedAttendees" class="mt-1 text-gray-900">
                  Loading...
                </p>
              </div>
              <div>
                <h3 class="text-sm font-medium text-gray-700">Event Type</h3>
                <div id="eventTypeContainer" class="mt-2 flex flex-wrap gap-2">
                  <span
                    class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-pink-100 text-pink-800"
                    >Event</span
                  >
                </div>
              </div>
              <div>
                <h3 class="text-sm font-medium text-gray-700">Categories</h3>
                <div id="categoriesContainer" class="mt-2 flex flex-wrap gap-2">
                  <span
                    class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-pink-100 text-pink-800"
                    >Education</span
                  >
                </div>
              </div>
              <div>
                <h3 class="text-sm font-medium text-gray-700">
                  Budget Required
                </h3>
                <p id="budget" class="mt-1 text-gray-900">Loading...</p>
              </div>
            </div>
          </div>

          <!-- Sponsorship History -->
          <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">
              Sponsorship History
            </h2>
            <div class="space-y-4">
              <div class="border-l-4 border-blue-500 pl-4">
                <h3 class="font-medium text-gray-900">
                  Digital Skills Bootcamp 2024
                </h3>
                <p class="text-sm text-gray-600">
                  Sponsored by: TechCorp Solutions
                </p>
                <p class="text-sm text-gray-500">April 10, 2024</p>
              </div>
              <div class="border-l-4 border-blue-500 pl-4">
                <h3 class="font-medium text-gray-900">EduFest 2023</h3>
                <p class="text-sm text-gray-600">Sponsored by: EduFund BD</p>
                <p class="text-sm text-gray-500">November 22, 2023</p>
              </div>
              <div class="border-l-4 border-blue-500 pl-4">
                <h3 class="font-medium text-gray-900">
                  Youth Empowerment Workshop
                </h3>
                <p class="text-sm text-gray-600">Sponsored by: YouthSpark</p>
                <p class="text-sm text-gray-500">July 5, 2023</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Image Upload Modal -->
    <div
      id="imageUploadModal"
      style="
        display: none;
        position: fixed;
        z-index: 2000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        overflow: auto;
        justify-content: center;
        align-items: center;
      "
    >
      <div
        style="
          background-color: #fefcfb;
          padding: 30px;
          border-radius: 15px;
          width: 90%;
          max-width: 500px;
          position: relative;
        "
      >
        <span
          class="close-btn"
          onclick="closeImageUploadModal()"
          style="
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #666;
          "
          >&times;</span
        >
        <h2
          id="imageModalTitle"
          style="
            font-size: 1.5rem;
            font-weight: bold;
            color: #111827;
            margin-bottom: 1.5rem;
          "
        >
          Update Image
        </h2>

        <div style="margin-bottom: 1.5rem">
          <label
            style="
              display: block;
              font-size: 0.875rem;
              font-weight: 500;
              color: #374151;
              margin-bottom: 0.5rem;
            "
            >Choose Image</label
          >
          <input
            type="file"
            id="imageFileInput"
            accept="image/*"
            style="
              width: 100%;
              padding: 0.5rem;
              border: 1px solid #d1d5db;
              border-radius: 0.375rem;
            "
          />
        </div>

        <div style="margin-bottom: 1.5rem">
          <label
            style="
              display: block;
              font-size: 0.875rem;
              font-weight: 500;
              color: #374151;
              margin-bottom: 0.5rem;
            "
            >Or paste image URL</label
          >
          <input
            type="text"
            id="imageUrlInput"
            placeholder="https://example.com/image.jpg"
            style="
              width: 100%;
              padding: 0.5rem;
              border: 1px solid #d1d5db;
              border-radius: 0.375rem;
            "
          />
        </div>

        <div
          id="imagePreviewContainer"
          style="display: none; margin-bottom: 1.5rem; text-align: center"
        >
          <img
            id="imagePreview"
            style="
              max-width: 100%;
              max-height: 300px;
              border-radius: 0.375rem;
              border: 1px solid #d1d5db;
            "
          />
        </div>

        <button
          onclick="saveImage()"
          type="button"
          style="
            width: 100%;
            background: #a855f7;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
          "
        >
          Save Image
        </button>

        <!-- Status Messages -->
        <div
          id="imageModalSuccess"
          style="
            display: none;
            margin-top: 1rem;
            background-color: #dcfce7;
            border: 1px solid #86efac;
            color: #166534;
            padding: 1rem;
            border-radius: 0.375rem;
          "
        >
          Image updated successfully!
        </div>
        <div
          id="imageModalError"
          style="
            display: none;
            margin-top: 1rem;
            background-color: #fee2e2;
            border: 1px solid #fca5a5;
            color: #991b1b;
            padding: 1rem;
            border-radius: 0.375rem;
          "
        >
          <span id="imageModalErrorMessage">Error updating image</span>
        </div>
      </div>
    </div>

    <!-- Edit Modal -->
    <div
      id="editModal"
      style="
        display: none;
        position: fixed;
        z-index: 2000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        overflow: auto;
        justify-content: center;
        align-items: center;
      "
    >
      <div
        style="
          background-color: #fefcfb;
          padding: 30px;
          border-radius: 15px;
          width: 90%;
          max-width: 600px;
          max-height: 90vh;
          overflow-y: auto;
          position: relative;
        "
      >
        <span
          class="close-btn"
          onclick="closeEditModal()"
          style="
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #666;
          "
          >&times;</span
        >
        <h2
          id="modalTitle"
          style="
            font-size: 1.5rem;
            font-weight: bold;
            color: #111827;
            margin-bottom: 1.5rem;
          "
        >
          Edit Profile
        </h2>

        <form id="editForm" style="display: contents">
          <!-- Contact Fields -->
          <div
            id="contactFields"
            style="
              display: none;
              gap: 1rem;
              display: flex;
              flex-direction: column;
            "
          >
            <div>
              <label
                style="
                  display: block;
                  font-size: 0.875rem;
                  font-weight: 500;
                  color: #374151;
                  margin-bottom: 0.5rem;
                "
                >Contact Person</label
              >
              <input
                type="text"
                id="editContactPerson"
                style="
                  width: 100%;
                  padding: 0.5rem;
                  border: 1px solid #d1d5db;
                  border-radius: 0.375rem;
                "
              />
            </div>
            <div>
              <label
                style="
                  display: block;
                  font-size: 0.875rem;
                  font-weight: 500;
                  color: #374151;
                  margin-bottom: 0.5rem;
                "
                >Phone</label
              >
              <input
                type="tel"
                id="editPhone"
                style="
                  width: 100%;
                  padding: 0.5rem;
                  border: 1px solid #d1d5db;
                  border-radius: 0.375rem;
                "
              />
            </div>
            <div>
              <label
                style="
                  display: block;
                  font-size: 0.875rem;
                  font-weight: 500;
                  color: #374151;
                  margin-bottom: 0.5rem;
                "
                >Location</label
              >
              <input
                type="text"
                id="editLocation"
                style="
                  width: 100%;
                  padding: 0.5rem;
                  border: 1px solid #d1d5db;
                  border-radius: 0.375rem;
                "
              />
            </div>
          </div>

          <!-- About Fields -->
          <div
            id="aboutFields"
            style="
              display: none;
              gap: 1rem;
              display: flex;
              flex-direction: column;
            "
          >
            <div>
              <label
                style="
                  display: block;
                  font-size: 0.875rem;
                  font-weight: 500;
                  color: #374151;
                  margin-bottom: 0.5rem;
                "
                >Event Name</label
              >
              <input
                type="text"
                id="editEventName"
                style="
                  width: 100%;
                  padding: 0.5rem;
                  border: 1px solid #d1d5db;
                  border-radius: 0.375rem;
                "
              />
            </div>
            <div>
              <label
                style="
                  display: block;
                  font-size: 0.875rem;
                  font-weight: 500;
                  color: #374151;
                  margin-bottom: 0.5rem;
                "
                >Organization</label
              >
              <input
                type="text"
                id="editOrganization"
                style="
                  width: 100%;
                  padding: 0.5rem;
                  border: 1px solid #d1d5db;
                  border-radius: 0.375rem;
                "
              />
            </div>
            <div>
              <label
                style="
                  display: block;
                  font-size: 0.875rem;
                  font-weight: 500;
                  color: #374151;
                  margin-bottom: 0.5rem;
                "
                >Description</label
              >
              <textarea
                id="editDescription"
                rows="5"
                style="
                  width: 100%;
                  padding: 0.5rem;
                  border: 1px solid #d1d5db;
                  border-radius: 0.375rem;
                "
              ></textarea>
            </div>
          </div>

          <!-- Event Fields -->
          <div
            id="eventFields"
            style="
              display: none;
              gap: 1rem;
              display: flex;
              flex-direction: column;
            "
          >
            <div>
              <label
                style="
                  display: block;
                  font-size: 0.875rem;
                  font-weight: 500;
                  color: #374151;
                  margin-bottom: 0.5rem;
                "
                >Expected Attendees</label
              >
              <input
                type="number"
                id="editExpectedAttendees"
                style="
                  width: 100%;
                  padding: 0.5rem;
                  border: 1px solid #d1d5db;
                  border-radius: 0.375rem;
                "
              />
            </div>
            <div>
              <label
                style="
                  display: block;
                  font-size: 0.875rem;
                  font-weight: 500;
                  color: #374151;
                  margin-bottom: 0.5rem;
                "
                >Event Type (comma-separated)</label
              >
              <input
                type="text"
                id="editEventType"
                placeholder="e.g., Conference, Workshop"
                style="
                  width: 100%;
                  padding: 0.5rem;
                  border: 1px solid #d1d5db;
                  border-radius: 0.375rem;
                "
              />
            </div>
            <div>
              <label
                style="
                  display: block;
                  font-size: 0.875rem;
                  font-weight: 500;
                  color: #374151;
                  margin-bottom: 0.5rem;
                "
                >Categories (comma-separated)</label
              >
              <input
                type="text"
                id="editCategories"
                placeholder="e.g., Education, Technology"
                style="
                  width: 100%;
                  padding: 0.5rem;
                  border: 1px solid #d1d5db;
                  border-radius: 0.375rem;
                "
              />
            </div>
            <div>
              <label
                style="
                  display: block;
                  font-size: 0.875rem;
                  font-weight: 500;
                  color: #374151;
                  margin-bottom: 0.5rem;
                "
                >Budget (BDT)</label
              >
              <input
                type="number"
                id="editBudget"
                style="
                  width: 100%;
                  padding: 0.5rem;
                  border: 1px solid #d1d5db;
                  border-radius: 0.375rem;
                "
              />
            </div>
          </div>

          <button
            type="submit"
            style="
              width: 100%;
              background: #a855f7;
              color: white;
              padding: 0.5rem 1rem;
              border-radius: 0.375rem;
              font-weight: 600;
              margin-top: 1.5rem;
              border: none;
              cursor: pointer;
            "
          >
            Save Changes
          </button>
        </form>

        <!-- Status Messages -->
        <div
          id="modalSuccess"
          style="
            display: none;
            margin-top: 1rem;
            background-color: #dcfce7;
            border: 1px solid #86efac;
            color: #166534;
            padding: 1rem;
            border-radius: 0.375rem;
          "
        >
          Profile updated successfully!
        </div>
        <div
          id="modalError"
          style="
            display: none;
            margin-top: 1rem;
            background-color: #fee2e2;
            border: 1px solid #fca5a5;
            color: #991b1b;
            padding: 1rem;
            border-radius: 0.375rem;
          "
        >
          <span id="modalErrorMessage">Error updating profile</span>
        </div>
      </div>
    </div>

    <script>
      // Global variables
      const API_BASE = "https://test-6aiv.onrender.com/api";
      let currentSponseeData = {};
      let currentEditSection = null;
      let currentImageType = null; // 'profile' or 'cover'

      // Image upload functions
      function openImageUploadModal(type) {
        currentImageType = type;
        const modal = document.getElementById("imageUploadModal");
        const title = document.getElementById("imageModalTitle");

        title.textContent =
          type === "profile" ? "Update Profile Picture" : "Update Cover Photo";

        // Reset inputs
        document.getElementById("imageFileInput").value = "";
        document.getElementById("imageUrlInput").value = "";
        document.getElementById("imagePreviewContainer").style.display = "none";
        document.getElementById("imageModalSuccess").style.display = "none";
        document.getElementById("imageModalError").style.display = "none";

        modal.style.display = "flex";
      }

      function closeImageUploadModal() {
        document.getElementById("imageUploadModal").style.display = "none";
        currentImageType = null;
      }

      async function saveImage() {
        const userId = localStorage.getItem("userId");
        const fileInput = document.getElementById("imageFileInput");
        const urlInput = document.getElementById("imageUrlInput");

        let imageUrl = urlInput.value.trim();

        // If file is selected, use FileReader to convert to base64
        if (fileInput.files && fileInput.files[0]) {
          const file = fileInput.files[0];

          // Check file size (max 5MB)
          if (file.size > 5 * 1024 * 1024) {
            document.getElementById("imageModalError").style.display = "block";
            document.getElementById("imageModalErrorMessage").textContent =
              "File size must be less than 5MB";
            return;
          }

          // Compress and resize image before uploading
          compressImage(file, async function (compressedBase64) {
            imageUrl = compressedBase64;
            await updateImageOnServer(userId, imageUrl);
          });
        } else if (imageUrl) {
          // Use URL directly
          await updateImageOnServer(userId, imageUrl);
        } else {
          document.getElementById("imageModalError").style.display = "block";
          document.getElementById("imageModalErrorMessage").textContent =
            "Please select a file or enter an image URL";
        }
      }

      // Compress image to reduce size
      function compressImage(file, callback) {
        const reader = new FileReader();
        reader.onload = function (e) {
          const img = new Image();
          img.onload = function () {
            const canvas = document.createElement("canvas");
            const ctx = canvas.getContext("2d");

            // Set max dimensions
            const maxWidth = currentImageType === "cover" ? 1200 : 400;
            const maxHeight = currentImageType === "cover" ? 400 : 400;

            let width = img.width;
            let height = img.height;

            // Calculate new dimensions
            if (width > height) {
              if (width > maxWidth) {
                height = height * (maxWidth / width);
                width = maxWidth;
              }
            } else {
              if (height > maxHeight) {
                width = width * (maxHeight / height);
                height = maxHeight;
              }
            }

            canvas.width = width;
            canvas.height = height;

            // Draw and compress
            ctx.drawImage(img, 0, 0, width, height);

            // Convert to base64 with reduced quality
            const compressedBase64 = canvas.toDataURL("image/jpeg", 0.7);
            callback(compressedBase64);
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }

      async function updateImageOnServer(userId, imageUrl) {
        const payload = {};

        if (currentImageType === "profile") {
          payload.logo = imageUrl;
        } else {
          payload.coverPhoto = imageUrl;
        }

        console.log("Updating image:", payload);

        try {
          const response = await fetch(`${API_BASE}/auth/sponsee/${userId}`, {
            method: "PUT",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(payload),
          });

          const data = await response.json();
          console.log("Image update response:", data);

          if (!response.ok) {
            throw new Error(data.message || "Failed to update image");
          }

          // Update local data
          currentSponseeData = data.data;

          // Update the image in the UI
          if (currentImageType === "profile") {
            document.getElementById("profilePicture").src = imageUrl;
          } else {
            document.getElementById("coverPhoto").src = imageUrl;
          }

          // Show success message
          document.getElementById("imageModalSuccess").style.display = "block";
          document.getElementById("imageModalError").style.display = "none";

          // Close modal after 2 seconds
          setTimeout(() => {
            closeImageUploadModal();
          }, 2000);
        } catch (error) {
          console.error("Error updating image:", error);
          document.getElementById("imageModalError").style.display = "block";
          document.getElementById("imageModalErrorMessage").textContent =
            error.message;
        }
      }

      // Preview image when URL is entered or file is selected
      document.addEventListener("DOMContentLoaded", function () {
        const fileInput = document.getElementById("imageFileInput");
        const urlInput = document.getElementById("imageUrlInput");
        const previewContainer = document.getElementById(
          "imagePreviewContainer"
        );
        const previewImg = document.getElementById("imagePreview");

        if (fileInput) {
          fileInput.addEventListener("change", function (e) {
            if (e.target.files && e.target.files[0]) {
              const reader = new FileReader();
              reader.onload = function (event) {
                previewImg.src = event.target.result;
                previewContainer.style.display = "block";
              };
              reader.readAsDataURL(e.target.files[0]);
              urlInput.value = ""; // Clear URL input
            }
          });
        }

        if (urlInput) {
          urlInput.addEventListener("input", function (e) {
            const url = e.target.value.trim();
            if (url) {
              previewImg.src = url;
              previewContainer.style.display = "block";
              fileInput.value = ""; // Clear file input
            } else {
              previewContainer.style.display = "none";
            }
          });
        }
      });

      // Load sponsee profile
      async function loadSponseeProfile(userId) {
        try {
          if (!userId) {
            throw new Error("No userId provided. Please log in first.");
          }

          console.log("Loading profile for userId:", userId);
          const url = `${API_BASE}/auth/sponsee/${userId}`;
          console.log("Fetching from:", url);

          const response = await fetch(url);
          console.log("Response status:", response.status);

          if (!response.ok) {
            const errorData = await response.json().catch(() => ({}));
            throw new Error(
              `Failed to load profile: ${response.status} - ${
                errorData.message || "Unknown error"
              }`
            );
          }

          const data = await response.json();
          console.log("Profile data received:", data);

          if (!data.success || !data.data) {
            throw new Error("Invalid response format from server");
          }

          currentSponseeData = data.data;
          console.log("currentSponseeData set to:", currentSponseeData);

          displayProfile();
        } catch (error) {
          console.error("Error loading profile:", error);
          const profileContainer = document.getElementById("profile-container");
          if (profileContainer) {
            profileContainer.innerHTML = `
              <div class="text-center py-12">
                <div class="bg-red-50 border border-red-200 rounded-lg p-6 max-w-md mx-auto">
                  <p class="text-red-600 font-semibold mb-2">⚠️ Unable to Load Profile</p>
                  <p class="text-gray-700 mb-4">${error.message}</p>
                  <p class="text-sm text-gray-600 mb-4">API Base: ${API_BASE}</p>
                  <button onclick="location.reload()" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700">
                    <i class="fas fa-redo mr-2"></i>Retry
                  </button>
                </div>
              </div>
            `;
          }
          alert("Error loading profile: " + error.message);
        }
      }

      function displayProfile() {
        const data = currentSponseeData;
        console.log("displayProfile called with:", data);

        // Helper function to safely set text content
        const safeSetText = (id, value) => {
          const element = document.getElementById(id);
          if (element) {
            element.textContent = value;
          } else {
            console.error(`Element with id '${id}' not found`);
          }
        };

        // Set basic text fields
        safeSetText("eventName", data.eventName || "N/A");
        safeSetText("organization", data.organization || "N/A");
        safeSetText("email", data.email || "N/A");
        safeSetText("phone", data.phone || "N/A");
        safeSetText("contactPerson", data.contactPerson || "N/A");
        safeSetText("location", data.location || "N/A");
        safeSetText(
          "description",
          data.description || "No description provided"
        );
        safeSetText("expectedAttendees", data.expectedAttendees || "N/A");
        safeSetText("budget", `৳${(data.budget || 0).toLocaleString()}`);

        // Display event types
        const eventTypeContainer =
          document.getElementById("eventTypeContainer");
        if (eventTypeContainer) {
          const eventTypeHtml = (data.eventType || [])
            .map(
              (type) =>
                `<span style="display: inline-flex; align-items: center; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.875rem; font-weight: 500; background-color: #ede9fe; color: #6d28d9;">${type}</span>`
            )
            .join("");
          eventTypeContainer.innerHTML = eventTypeHtml || "N/A";
        } else {
          console.error("Element with id 'eventTypeContainer' not found");
        }

        // Display categories
        const categoriesContainer = document.getElementById(
          "categoriesContainer"
        );
        if (categoriesContainer) {
          const categoriesHtml = (data.categories || [])
            .map(
              (cat) =>
                `<span style="display: inline-flex; align-items: center; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.875rem; font-weight: 500; background-color: #fce7f3; color: #be185d;">${cat}</span>`
            )
            .join("");
          categoriesContainer.innerHTML = categoriesHtml || "N/A";
        } else {
          console.error("Element with id 'categoriesContainer' not found");
        }

        // Display profile picture (logo)
        const profilePicture = document.getElementById("profilePicture");
        if (profilePicture && data.logo) {
          profilePicture.src = data.logo;
        }

        // Display cover photo
        const coverPhoto = document.getElementById("coverPhoto");
        if (coverPhoto && data.coverPhoto) {
          coverPhoto.src = data.coverPhoto;
        }
      }

      function openEditModal(section) {
        currentEditSection = section;
        const modal = document.getElementById("editModal");

        // Hide all field sections
        document.getElementById("contactFields").style.display = "none";
        document.getElementById("aboutFields").style.display = "none";
        document.getElementById("eventFields").style.display = "none";
        document.getElementById("modalSuccess").style.display = "none";
        document.getElementById("modalError").style.display = "none";

        // Show relevant section and populate fields
        if (section === "contact") {
          document.getElementById("modalTitle").textContent =
            "Edit Contact Information";
          document.getElementById("contactFields").style.display = "flex";
          document.getElementById("editContactPerson").value =
            currentSponseeData.contactPerson;
          document.getElementById("editPhone").value = currentSponseeData.phone;
          document.getElementById("editLocation").value =
            currentSponseeData.location;
        } else if (section === "about") {
          document.getElementById("modalTitle").textContent =
            "Edit About Information";
          document.getElementById("aboutFields").style.display = "flex";
          document.getElementById("editEventName").value =
            currentSponseeData.eventName;
          document.getElementById("editOrganization").value =
            currentSponseeData.organization;
          document.getElementById("editDescription").value =
            currentSponseeData.description || "";
        } else if (section === "event") {
          document.getElementById("modalTitle").textContent =
            "Edit Event Details";
          document.getElementById("eventFields").style.display = "flex";
          document.getElementById("editExpectedAttendees").value =
            currentSponseeData.expectedAttendees;
          document.getElementById("editEventType").value = (
            currentSponseeData.eventType || []
          ).join(", ");
          document.getElementById("editCategories").value = (
            currentSponseeData.categories || []
          ).join(", ");
          document.getElementById("editBudget").value =
            currentSponseeData.budget;
        }

        modal.style.display = "flex";
      }

      function closeEditModal() {
        document.getElementById("editModal").style.display = "none";
        currentEditSection = null;
      }

      async function submitEditForm() {
        const userId = localStorage.getItem("userId");
        console.log("Submitting edit form for userId:", userId);
        console.log("Current edit section:", currentEditSection);

        let payload = {};

        if (currentEditSection === "contact") {
          payload = {
            contactPerson: document
              .getElementById("editContactPerson")
              .value.trim(),
            phone: document.getElementById("editPhone").value.trim(),
            location: document.getElementById("editLocation").value.trim(),
          };
        } else if (currentEditSection === "about") {
          payload = {
            eventName: document.getElementById("editEventName").value.trim(),
            organization: document
              .getElementById("editOrganization")
              .value.trim(),
            description: document
              .getElementById("editDescription")
              .value.trim(),
          };
        } else if (currentEditSection === "event") {
          payload = {
            expectedAttendees: parseInt(
              document.getElementById("editExpectedAttendees").value
            ),
            eventType: document
              .getElementById("editEventType")
              .value.split(",")
              .map((e) => e.trim())
              .filter((e) => e),
            categories: document
              .getElementById("editCategories")
              .value.split(",")
              .map((e) => e.trim())
              .filter((e) => e),
            budget: parseInt(document.getElementById("editBudget").value),
          };
        }

        console.log("Sending payload:", payload);

        try {
          const url = `${API_BASE}/auth/sponsee/${userId}`;
          console.log("Sending PUT request to:", url);

          const response = await fetch(url, {
            method: "PUT",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(payload),
          });

          console.log("Response status:", response.status);
          const data = await response.json();
          console.log("Response data:", data);

          if (!response.ok) {
            throw new Error(data.message || "Failed to update profile");
          }

          // Update local data and refresh display
          currentSponseeData = data.data;
          console.log("Profile updated successfully:", currentSponseeData);
          displayProfile();

          // Show success message
          document.getElementById("modalSuccess").style.display = "block";
          document.getElementById("modalError").style.display = "none";

          // Close modal after 2 seconds
          setTimeout(() => {
            closeEditModal();
          }, 2000);
        } catch (error) {
          console.error("Error submitting form:", error);
          document.getElementById("modalError").style.display = "block";
          document.getElementById("modalErrorMessage").textContent =
            error.message;
        }
      }

      // Close modal when clicking outside
      window.onclick = function (event) {
        const modal = document.getElementById("editModal");
        if (event.target == modal) {
          closeEditModal();
        }
      };

      // Initialize on page load
      document.addEventListener("DOMContentLoaded", function () {
        // Setup mobile menu
        const mobileMenu = document.querySelector(".mobile-menu");
        const navLinks = document.querySelector(".nav-links");
        const navButtons = document.querySelector(".nav-buttons");

        if (mobileMenu) {
          mobileMenu.addEventListener("click", function () {
            // Create mobile menu overlay
            const overlay = document.createElement("div");
            overlay.style.position = "fixed";
            overlay.style.top = "0";
            overlay.style.left = "0";
            overlay.style.width = "100%";
            overlay.style.height = "100%";
            overlay.style.background = "rgba(0, 0, 0, 0.5)";
            overlay.style.zIndex = "999";
            document.body.appendChild(overlay);

            // Create mobile menu container
            const mobileNav = document.createElement("div");
            mobileNav.style.position = "fixed";
            mobileNav.style.top = "0";
            mobileNav.style.right = "0";
            mobileNav.style.width = "250px";
            mobileNav.style.height = "100%";
            mobileNav.style.background = "white";
            mobileNav.style.padding = "20px";
            mobileNav.style.zIndex = "1000";
            mobileNav.style.boxShadow = "-2px 0 10px rgba(0, 0, 0, 0.1)";

            // Clone navigation links
            const mobileLinks = navLinks.cloneNode(true);
            mobileLinks.style.display = "flex";
            mobileLinks.style.flexDirection = "column";
            mobileLinks.style.gap = "1rem";
            mobileLinks.style.marginTop = "2rem";

            // Clone navigation buttons
            const mobileButtons = navButtons.cloneNode(true);
            mobileButtons.style.display = "flex";
            mobileButtons.style.flexDirection = "column";
            mobileButtons.style.gap = "1rem";
            mobileButtons.style.marginTop = "2rem";

            // Add close button
            const closeButton = document.createElement("button");
            closeButton.innerHTML = '<i class="fas fa-times"></i>';
            closeButton.style.background = "none";
            closeButton.style.border = "none";
            closeButton.style.fontSize = "1.5rem";
            closeButton.style.cursor = "pointer";
            closeButton.style.alignSelf = "flex-end";

            // Append elements to mobile menu
            mobileNav.appendChild(closeButton);
            mobileNav.appendChild(mobileLinks);
            mobileNav.appendChild(mobileButtons);
            document.body.appendChild(mobileNav);

            // Close mobile menu
            function closeMenu() {
              overlay.remove();
              mobileNav.remove();
            }

            closeButton.addEventListener("click", closeMenu);
            overlay.addEventListener("click", closeMenu);
          });
        }

        // Load sponsee profile by URL id if present; else fallback to logged-in user
        const params = new URLSearchParams(window.location.search);
        const idParam = params.get("id");
        const loggedInId = localStorage.getItem("userId");
        const canEdit = idParam
          ? loggedInId && idParam === loggedInId
          : !!loggedInId;

        // Hide edit controls if viewing another user's profile
        if (!canEdit) {
          const editButtons = document.querySelectorAll(
            'button[onclick^="openEditModal"], button[onclick^="openImageUploadModal"]'
          );
          editButtons.forEach((btn) => (btn.style.display = "none"));
        }

        if (idParam) {
          loadSponseeProfile(idParam);
        } else {
          if (loggedInId) {
            loadSponseeProfile(loggedInId);
          } else {
            alert("Please log in first");
            window.location.href = "/index.html";
          }
        }

        // Attach form submission handler
        const editForm = document.getElementById("editForm");
        if (editForm) {
          editForm.addEventListener("submit", function (e) {
            e.preventDefault();
            submitEditForm();
          });
        }
      });
    </script>
    <script src="../../components/navbar.js"></script>
  </body>
</html>
