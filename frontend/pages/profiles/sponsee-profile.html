<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sponsee Profile - SponzoBD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { font-family: "Inter", sans-serif; overflow-x: hidden; }
      ::-webkit-scrollbar { width: 8px; }
      ::-webkit-scrollbar-track { background: #1a1a2e; }
      ::-webkit-scrollbar-thumb { background: linear-gradient(180deg, #ec4899, #f97316); border-radius: 10px; }
      .page-bg {
        background: linear-gradient(-45deg, #0f0c29, #302b63, #24243e, #1a1a2e);
        background-size: 400% 400%;
        animation: gradientShift 15s ease infinite;
        min-height: 100vh;
      }
      @keyframes gradientShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
      .particles { position: fixed; width: 100%; height: 100%; overflow: hidden; top: 0; left: 0; pointer-events: none; z-index: 0; }
      .particle { position: absolute; width: 6px; height: 6px; background: rgba(236, 72, 153, 0.4); border-radius: 50%; animation: floatParticle 20s infinite; }
      .particle:nth-child(1) { left: 10%; animation-delay: 0s; }
      .particle:nth-child(2) { left: 30%; animation-delay: 2s; }
      .particle:nth-child(3) { left: 50%; animation-delay: 4s; }
      .particle:nth-child(4) { left: 70%; animation-delay: 1s; }
      .particle:nth-child(5) { left: 90%; animation-delay: 3s; }
      @keyframes floatParticle {
        0% { transform: translateY(100vh) scale(0); opacity: 0; }
        10% { opacity: 1; }
        90% { opacity: 1; }
        100% { transform: translateY(-100vh) scale(1); opacity: 0; }
      }
      .glass-card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        transition: all 0.4s ease;
      }
      .glass-card:hover {
        border-color: rgba(236, 72, 153, 0.3);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      }
      .gradient-text {
        background: linear-gradient(135deg, #ec4899 0%, #f97316 50%, #a855f7 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      .orb { position: fixed; border-radius: 50%; filter: blur(80px); opacity: 0.3; animation: orbFloat 8s ease-in-out infinite; pointer-events: none; z-index: 0; }
      .orb-1 { width: 350px; height: 350px; background: linear-gradient(135deg, #ec4899, #f97316); top: -100px; right: -100px; }
      .orb-2 { width: 280px; height: 280px; background: linear-gradient(135deg, #7c3aed, #a855f7); bottom: -80px; left: -80px; animation-delay: 2s; }
      @keyframes orbFloat { 0%, 100% { transform: translate(0, 0) scale(1); } 50% { transform: translate(30px, 30px) scale(1.1); } }
      .profile-section {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 16px;
        padding: 1.5rem;
      }
      .modal-overlay {
        display: none;
        position: fixed;
        z-index: 2000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(5px);
        overflow: auto;
        justify-content: center;
        align-items: center;
      }
      .modal-content {
        background: linear-gradient(145deg, #1a1a2e, #16162a);
        border: 1px solid rgba(255, 255, 255, 0.1);
        padding: 30px;
        border-radius: 20px;
        width: 90%;
        max-width: 500px;
        position: relative;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
      }
      .modal-input {
        width: 100%;
        padding: 12px 16px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        color: white;
        font-size: 0.95rem;
        transition: all 0.3s ease;
      }
      .modal-input:focus {
        outline: none;
        border-color: rgba(236, 72, 153, 0.5);
        box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.1);
      }
      .modal-input::placeholder { color: rgba(255, 255, 255, 0.4); }
      .modal-label {
        display: block;
        font-size: 0.875rem;
        font-weight: 500;
        color: #d1d5db;
        margin-bottom: 0.5rem;
      }
      .btn-gradient {
        background: linear-gradient(135deg, #ec4899, #f97316);
        color: white;
        padding: 12px 24px;
        border-radius: 12px;
        font-weight: 600;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 100%;
      }
      .btn-gradient:hover {
        box-shadow: 0 10px 20px rgba(236, 72, 153, 0.3);
        transform: translateY(-2px);
      }
    </style>
  </head>
  <body class="page-bg">
    <div class="particles">
      <div class="particle"></div><div class="particle"></div><div class="particle"></div>
      <div class="particle"></div><div class="particle"></div>
    </div>
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>

    <div id="navbar"></div>

    <!-- Main Content -->
    <main class="relative z-10 max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-28">
      <!-- Profile Header -->
      <div class="glass-card overflow-hidden mb-6" data-aos="fade-up">
        <div class="relative h-48 bg-gradient-to-br from-pink-900/50 to-orange-900/50">
          <img id="coverPhoto" src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1200&h=400&q=80" alt="Cover Image" class="w-full h-full object-cover opacity-80" />
          <button onclick="openImageUploadModal('cover')" class="absolute bottom-4 right-4 bg-white/10 backdrop-blur-md p-2 rounded-full border border-white/20 hover:bg-white/20 transition" type="button">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" viewBox="0 0 20 20" fill="currentColor">
              <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"/>
            </svg>
          </button>
        </div>
        <div class="relative px-6 py-4">
          <div class="absolute -top-16 left-6">
            <div class="relative group">
              <img id="profilePicture" src="https://images.unsplash.com/photo-1517841905240-472988babdf9?auto=format&fit=crop&w=128&h=128&q=80" alt="Project Logo" class="w-32 h-32 rounded-xl border-4 border-[#1a1a2e] shadow-xl bg-[#1a1a2e] object-cover" />
              <button onclick="openImageUploadModal('profile')" class="absolute inset-0 flex items-center justify-center bg-black/60 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity" type="button">
                <i class="fas fa-camera text-white text-2xl"></i>
              </button>
            </div>
          </div>
          <div class="mt-16">
            <h1 id="eventName" class="text-2xl font-bold text-white font-space">Loading...</h1>
            <p id="organization" class="text-pink-400">Loading...</p>
          </div>
        </div>
      </div>

      <!-- Profile Content -->
      <div id="profile-container" class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Left Column -->
        <div class="md:col-span-1 space-y-6">
          <!-- Contact Information -->
          <div class="profile-section" data-aos="fade-up" data-aos-delay="100">
            <div class="flex justify-between items-center mb-4">
              <h2 class="text-lg font-semibold text-white">Contact Information</h2>
              <button onclick="openEditModal('contact')" class="text-pink-400 hover:text-pink-300 transition">
                <i class="fas fa-edit"></i>
              </button>
            </div>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-500">Email</label>
                <p id="email" class="mt-1 text-gray-200">Loading...</p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-500">Phone</label>
                <p id="phone" class="mt-1 text-gray-200">Loading...</p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-500">Contact Person</label>
                <p id="contactPerson" class="mt-1 text-gray-200">Loading...</p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-500">Location</label>
                <p id="location" class="mt-1 text-gray-200">Loading...</p>
              </div>
            </div>
          </div>

          <!-- Project Links -->
          <div class="profile-section" data-aos="fade-up" data-aos-delay="200">
            <h2 class="text-lg font-semibold text-white mb-4">Project Links</h2>
            <div class="space-y-4">
              <a href="#" class="flex items-center text-pink-400 hover:text-pink-300 transition">
                <svg class="h-5 w-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
                Project Website
              </a>
              <a href="#" class="flex items-center text-pink-400 hover:text-pink-300 transition">
                <svg class="h-5 w-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
                </svg>
                Facebook Page
              </a>
            </div>
          </div>
        </div>

        <!-- Right Column -->
        <div class="md:col-span-2 space-y-6">
          <!-- About -->
          <div class="profile-section" data-aos="fade-up" data-aos-delay="100">
            <div class="flex justify-between items-center mb-4">
              <h2 class="text-lg font-semibold text-white">About</h2>
              <button onclick="openEditModal('about')" class="text-pink-400 hover:text-pink-300 transition">
                <i class="fas fa-edit"></i>
              </button>
            </div>
            <p id="description" class="text-gray-400">Loading...</p>
          </div>

          <!-- Event Details -->
          <div class="profile-section" data-aos="fade-up" data-aos-delay="200">
            <div class="flex justify-between items-center mb-4">
              <h2 class="text-lg font-semibold text-white">Event Details</h2>
              <button onclick="openEditModal('event')" class="text-pink-400 hover:text-pink-300 transition">
                <i class="fas fa-edit"></i>
              </button>
            </div>
            <div class="space-y-4">
              <div>
                <h3 class="text-sm font-medium text-gray-500">Expected Attendees</h3>
                <p id="expectedAttendees" class="mt-1 text-gray-200">Loading...</p>
              </div>
              <div>
                <h3 class="text-sm font-medium text-gray-500">Event Type</h3>
                <div id="eventTypeContainer" class="mt-2 flex flex-wrap gap-2">
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-pink-500/20 text-pink-300 border border-pink-500/30">Event</span>
                </div>
              </div>
              <div>
                <h3 class="text-sm font-medium text-gray-500">Categories</h3>
                <div id="categoriesContainer" class="mt-2 flex flex-wrap gap-2">
                  <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-orange-500/20 text-orange-300 border border-orange-500/30">Education</span>
                </div>
              </div>
              <div>
                <h3 class="text-sm font-medium text-gray-500">Budget Required</h3>
                <p id="budget" class="mt-1 text-2xl font-bold gradient-text font-space">Loading...</p>
              </div>
            </div>
          </div>

          <!-- Sponsorship History -->
          <div class="profile-section" data-aos="fade-up" data-aos-delay="300">
            <h2 class="text-lg font-semibold text-white mb-4">Sponsorship History</h2>
            <div class="space-y-4">
              <div class="border-l-4 border-pink-500 pl-4 py-2 bg-white/5 rounded-r-lg">
                <h3 class="font-medium text-white">Digital Skills Bootcamp 2024</h3>
                <p class="text-sm text-pink-400">Sponsored by: TechCorp Solutions</p>
                <p class="text-sm text-gray-500">April 10, 2024</p>
              </div>
              <div class="border-l-4 border-pink-500 pl-4 py-2 bg-white/5 rounded-r-lg">
                <h3 class="font-medium text-white">EduFest 2023</h3>
                <p class="text-sm text-pink-400">Sponsored by: EduFund BD</p>
                <p class="text-sm text-gray-500">November 22, 2023</p>
              </div>
              <div class="border-l-4 border-pink-500 pl-4 py-2 bg-white/5 rounded-r-lg">
                <h3 class="font-medium text-white">Youth Empowerment Workshop</h3>
                <p class="text-sm text-pink-400">Sponsored by: YouthSpark</p>
                <p class="text-sm text-gray-500">July 5, 2023</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Image Upload Modal -->
    <div id="imageUploadModal" class="modal-overlay">
      <div class="modal-content">
        <span class="close-btn absolute right-5 top-5 text-2xl font-bold cursor-pointer text-gray-400 hover:text-white transition" onclick="closeImageUploadModal()">&times;</span>
        <h2 id="imageModalTitle" class="text-xl font-bold text-white mb-6 font-space">Update Image</h2>
        <div class="mb-4">
          <label class="modal-label">Choose Image</label>
          <input type="file" id="imageFileInput" accept="image/*" class="modal-input" style="padding: 10px;" />
        </div>
        <div class="mb-4">
          <label class="modal-label">Or paste image URL</label>
          <input type="text" id="imageUrlInput" placeholder="https://example.com/image.jpg" class="modal-input" />
        </div>
        <div id="imagePreviewContainer" style="display: none;" class="mb-4 text-center">
          <img id="imagePreview" class="max-w-full max-h-48 rounded-lg border border-white/20 mx-auto" />
        </div>
        <button onclick="saveImage()" type="button" class="btn-gradient">Save Image</button>
        <div id="imageModalSuccess" style="display: none;" class="mt-4 bg-green-500/20 border border-green-500/30 text-green-300 p-4 rounded-xl">Image updated successfully!</div>
        <div id="imageModalError" style="display: none;" class="mt-4 bg-red-500/20 border border-red-500/30 text-red-300 p-4 rounded-xl"><span id="imageModalErrorMessage">Error updating image</span></div>
      </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal-overlay">
      <div class="modal-content" style="max-width: 600px; max-height: 90vh; overflow-y: auto;">
        <span class="close-btn absolute right-5 top-5 text-2xl font-bold cursor-pointer text-gray-400 hover:text-white transition" onclick="closeEditModal()">&times;</span>
        <h2 id="modalTitle" class="text-xl font-bold text-white mb-6 font-space">Edit Profile</h2>
        <form id="editForm">
          <!-- Contact Fields -->
          <div id="contactFields" style="display: none;" class="space-y-4">
            <div><label class="modal-label">Contact Person</label><input type="text" id="editContactPerson" class="modal-input" /></div>
            <div><label class="modal-label">Phone</label><input type="tel" id="editPhone" class="modal-input" /></div>
            <div><label class="modal-label">Location</label><input type="text" id="editLocation" class="modal-input" /></div>
          </div>
          <!-- About Fields -->
          <div id="aboutFields" style="display: none;" class="space-y-4">
            <div><label class="modal-label">Event Name</label><input type="text" id="editEventName" class="modal-input" /></div>
            <div><label class="modal-label">Organization</label><input type="text" id="editOrganization" class="modal-input" /></div>
            <div><label class="modal-label">Description</label><textarea id="editDescription" rows="5" class="modal-input"></textarea></div>
          </div>
          <!-- Event Fields -->
          <div id="eventFields" style="display: none;" class="space-y-4">
            <div><label class="modal-label">Expected Attendees</label><input type="number" id="editExpectedAttendees" class="modal-input" /></div>
            <div><label class="modal-label">Event Type (comma-separated)</label><input type="text" id="editEventType" placeholder="e.g., Conference, Workshop" class="modal-input" /></div>
            <div><label class="modal-label">Categories (comma-separated)</label><input type="text" id="editCategories" placeholder="e.g., Education, Technology" class="modal-input" /></div>
            <div><label class="modal-label">Budget (BDT)</label><input type="number" id="editBudget" class="modal-input" /></div>
          </div>
          <button type="submit" class="btn-gradient mt-6">Save Changes</button>
        </form>
        <div id="modalSuccess" style="display: none;" class="mt-4 bg-green-500/20 border border-green-500/30 text-green-300 p-4 rounded-xl">Profile updated successfully!</div>
        <div id="modalError" style="display: none;" class="mt-4 bg-red-500/20 border border-red-500/30 text-red-300 p-4 rounded-xl"><span id="modalErrorMessage">Error updating profile</span></div>
      </div>
    </div>

    <script>
      const API_BASE = "https://test-6aiv.onrender.com/api";
      let currentSponseeData = {};
      let currentEditSection = null;
      let currentImageType = null;

      AOS.init({ duration: 800, easing: "ease-out-cubic", once: true });

      function openImageUploadModal(type) {
        currentImageType = type;
        document.getElementById("imageModalTitle").textContent = type === "profile" ? "Update Profile Picture" : "Update Cover Photo";
        document.getElementById("imageFileInput").value = "";
        document.getElementById("imageUrlInput").value = "";
        document.getElementById("imagePreviewContainer").style.display = "none";
        document.getElementById("imageModalSuccess").style.display = "none";
        document.getElementById("imageModalError").style.display = "none";
        document.getElementById("imageUploadModal").style.display = "flex";
      }

      function closeImageUploadModal() { document.getElementById("imageUploadModal").style.display = "none"; currentImageType = null; }

      function compressImage(file, callback) {
        const reader = new FileReader();
        reader.onload = function (e) {
          const img = new Image();
          img.onload = function () {
            const canvas = document.createElement("canvas");
            const ctx = canvas.getContext("2d");
            const maxWidth = currentImageType === "cover" ? 1200 : 400;
            const maxHeight = currentImageType === "cover" ? 400 : 400;
            let width = img.width, height = img.height;
            if (width > height) { if (width > maxWidth) { height = height * (maxWidth / width); width = maxWidth; } }
            else { if (height > maxHeight) { width = width * (maxHeight / height); height = maxHeight; } }
            canvas.width = width; canvas.height = height;
            ctx.drawImage(img, 0, 0, width, height);
            callback(canvas.toDataURL("image/jpeg", 0.7));
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }

      async function saveImage() {
        const userId = localStorage.getItem("userId");
        const fileInput = document.getElementById("imageFileInput");
        const urlInput = document.getElementById("imageUrlInput");
        let imageUrl = urlInput.value.trim();
        if (fileInput.files && fileInput.files[0]) {
          const file = fileInput.files[0];
          if (file.size > 5 * 1024 * 1024) { document.getElementById("imageModalError").style.display = "block"; document.getElementById("imageModalErrorMessage").textContent = "File size must be less than 5MB"; return; }
          compressImage(file, async function (compressedBase64) { await updateImageOnServer(userId, compressedBase64); });
        } else if (imageUrl) { await updateImageOnServer(userId, imageUrl); }
        else { document.getElementById("imageModalError").style.display = "block"; document.getElementById("imageModalErrorMessage").textContent = "Please select a file or enter an image URL"; }
      }

      async function updateImageOnServer(userId, imageUrl) {
        const payload = currentImageType === "profile" ? { logo: imageUrl } : { coverPhoto: imageUrl };
        try {
          const response = await fetch(`${API_BASE}/auth/sponsee/${userId}`, { method: "PUT", headers: { "Content-Type": "application/json" }, body: JSON.stringify(payload) });
          const data = await response.json();
          if (!response.ok) throw new Error(data.message || "Failed to update image");
          currentSponseeData = data.data;
          if (currentImageType === "profile") document.getElementById("profilePicture").src = imageUrl;
          else document.getElementById("coverPhoto").src = imageUrl;
          document.getElementById("imageModalSuccess").style.display = "block";
          document.getElementById("imageModalError").style.display = "none";
          setTimeout(() => closeImageUploadModal(), 2000);
        } catch (error) { document.getElementById("imageModalError").style.display = "block"; document.getElementById("imageModalErrorMessage").textContent = error.message; }
      }

      async function loadSponseeProfile(userId) {
        try {
          if (!userId) throw new Error("No userId provided. Please log in first.");
          const response = await fetch(`${API_BASE}/auth/sponsee/${userId}`);
          if (!response.ok) { const errorData = await response.json().catch(() => ({})); throw new Error(`Failed to load profile: ${response.status} - ${errorData.message || "Unknown error"}`); }
          const data = await response.json();
          if (!data.success || !data.data) throw new Error("Invalid response format from server");
          currentSponseeData = data.data;
          displayProfile();
        } catch (error) {
          console.error("Error loading profile:", error);
          const profileContainer = document.getElementById("profile-container");
          if (profileContainer) { profileContainer.innerHTML = `<div class="col-span-3 text-center py-12"><div class="glass-card p-8 max-w-md mx-auto"><i class="fas fa-exclamation-circle text-4xl text-red-400 mb-4 block"></i><p class="text-white font-semibold mb-2">Unable to Load Profile</p><p class="text-gray-400 mb-4">${error.message}</p><button onclick="location.reload()" class="btn-gradient"><i class="fas fa-redo mr-2"></i>Retry</button></div></div>`; }
        }
      }

      function displayProfile() {
        const data = currentSponseeData;
        const safeSet = (id, value) => { const el = document.getElementById(id); if (el) el.textContent = value; };
        safeSet("eventName", data.eventName || "N/A");
        safeSet("organization", data.organization || "N/A");
        safeSet("email", data.email || "N/A");
        safeSet("phone", data.phone || "N/A");
        safeSet("contactPerson", data.contactPerson || "N/A");
        safeSet("location", data.location || "N/A");
        safeSet("description", data.description || "No description provided");
        safeSet("expectedAttendees", data.expectedAttendees || "N/A");
        safeSet("budget", `à§³${(data.budget || 0).toLocaleString()}`);
        const eventTypeContainer = document.getElementById("eventTypeContainer");
        if (eventTypeContainer) { eventTypeContainer.innerHTML = (data.eventType || []).map(type => `<span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-pink-500/20 text-pink-300 border border-pink-500/30">${type}</span>`).join("") || '<span class="text-gray-500">N/A</span>'; }
        const categoriesContainer = document.getElementById("categoriesContainer");
        if (categoriesContainer) { categoriesContainer.innerHTML = (data.categories || []).map(cat => `<span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-orange-500/20 text-orange-300 border border-orange-500/30">${cat}</span>`).join("") || '<span class="text-gray-500">N/A</span>'; }
        const profilePicture = document.getElementById("profilePicture");
        if (profilePicture && data.logo) profilePicture.src = data.logo;
        const coverPhoto = document.getElementById("coverPhoto");
        if (coverPhoto && data.coverPhoto) coverPhoto.src = data.coverPhoto;
      }

      function openEditModal(section) {
        currentEditSection = section;
        document.getElementById("contactFields").style.display = "none";
        document.getElementById("aboutFields").style.display = "none";
        document.getElementById("eventFields").style.display = "none";
        document.getElementById("modalSuccess").style.display = "none";
        document.getElementById("modalError").style.display = "none";
        if (section === "contact") {
          document.getElementById("modalTitle").textContent = "Edit Contact Information";
          document.getElementById("contactFields").style.display = "block";
          document.getElementById("editContactPerson").value = currentSponseeData.contactPerson || "";
          document.getElementById("editPhone").value = currentSponseeData.phone || "";
          document.getElementById("editLocation").value = currentSponseeData.location || "";
        } else if (section === "about") {
          document.getElementById("modalTitle").textContent = "Edit About Information";
          document.getElementById("aboutFields").style.display = "block";
          document.getElementById("editEventName").value = currentSponseeData.eventName || "";
          document.getElementById("editOrganization").value = currentSponseeData.organization || "";
          document.getElementById("editDescription").value = currentSponseeData.description || "";
        } else if (section === "event") {
          document.getElementById("modalTitle").textContent = "Edit Event Details";
          document.getElementById("eventFields").style.display = "block";
          document.getElementById("editExpectedAttendees").value = currentSponseeData.expectedAttendees || "";
          document.getElementById("editEventType").value = (currentSponseeData.eventType || []).join(", ");
          document.getElementById("editCategories").value = (currentSponseeData.categories || []).join(", ");
          document.getElementById("editBudget").value = currentSponseeData.budget || "";
        }
        document.getElementById("editModal").style.display = "flex";
      }

      function closeEditModal() { document.getElementById("editModal").style.display = "none"; currentEditSection = null; }

      async function submitEditForm() {
        const userId = localStorage.getItem("userId");
        let payload = {};
        if (currentEditSection === "contact") { payload = { contactPerson: document.getElementById("editContactPerson").value.trim(), phone: document.getElementById("editPhone").value.trim(), location: document.getElementById("editLocation").value.trim() }; }
        else if (currentEditSection === "about") { payload = { eventName: document.getElementById("editEventName").value.trim(), organization: document.getElementById("editOrganization").value.trim(), description: document.getElementById("editDescription").value.trim() }; }
        else if (currentEditSection === "event") { payload = { expectedAttendees: parseInt(document.getElementById("editExpectedAttendees").value), eventType: document.getElementById("editEventType").value.split(",").map(e => e.trim()).filter(e => e), categories: document.getElementById("editCategories").value.split(",").map(e => e.trim()).filter(e => e), budget: parseInt(document.getElementById("editBudget").value) }; }
        try {
          const response = await fetch(`${API_BASE}/auth/sponsee/${userId}`, { method: "PUT", headers: { "Content-Type": "application/json" }, body: JSON.stringify(payload) });
          const data = await response.json();
          if (!response.ok) throw new Error(data.message || "Failed to update profile");
          currentSponseeData = data.data;
          displayProfile();
          document.getElementById("modalSuccess").style.display = "block";
          document.getElementById("modalError").style.display = "none";
          setTimeout(() => closeEditModal(), 2000);
        } catch (error) { document.getElementById("modalError").style.display = "block"; document.getElementById("modalErrorMessage").textContent = error.message; }
      }

      window.onclick = function (event) {
        if (event.target === document.getElementById("editModal")) closeEditModal();
        if (event.target === document.getElementById("imageUploadModal")) closeImageUploadModal();
      };

      document.addEventListener("DOMContentLoaded", function () {
        const fileInput = document.getElementById("imageFileInput");
        const urlInput = document.getElementById("imageUrlInput");
        const previewContainer = document.getElementById("imagePreviewContainer");
        const previewImg = document.getElementById("imagePreview");
        if (fileInput) { fileInput.addEventListener("change", function (e) { if (e.target.files && e.target.files[0]) { const reader = new FileReader(); reader.onload = function (event) { previewImg.src = event.target.result; previewContainer.style.display = "block"; }; reader.readAsDataURL(e.target.files[0]); urlInput.value = ""; } }); }
        if (urlInput) { urlInput.addEventListener("input", function (e) { const url = e.target.value.trim(); if (url) { previewImg.src = url; previewContainer.style.display = "block"; fileInput.value = ""; } else { previewContainer.style.display = "none"; } }); }
        const params = new URLSearchParams(window.location.search);
        const idParam = params.get("id");
        const loggedInId = localStorage.getItem("userId");
        const canEdit = idParam ? loggedInId && idParam === loggedInId : !!loggedInId;
        if (!canEdit) { document.querySelectorAll('button[onclick^="openEditModal"], button[onclick^="openImageUploadModal"]').forEach(btn => btn.style.display = "none"); }
        if (idParam) { loadSponseeProfile(idParam); }
        else if (loggedInId) { loadSponseeProfile(loggedInId); }
        else { alert("Please log in first"); window.location.href = "/index.html"; }
        const editForm = document.getElementById("editForm");
        if (editForm) { editForm.addEventListener("submit", function (e) { e.preventDefault(); submitEditForm(); }); }
      });
    </script>
    <script src="../../components/navbar.js"></script>
  </body>
</html>
